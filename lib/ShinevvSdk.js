/*
 * ShinevvSdk v1.0.0
 * shinevv SDK
 * Copyright: 2017-2018 chence <chence@shinevv.com>
 * License: All Rights Reserved
 */

!function i(a,s,c){function u(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};a[t][0].call(o.exports,function(e){return u(a[t][1][e]||e)},o,o.exports,i,a,s,c)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,r){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":11}],2:[function(e,t,r){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":12}],3:[function(e,t,r){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":13}],4:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":14}],5:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":15}],6:[function(e,t,r){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":16}],7:[function(e,t,r){"use strict";r.__esModule=!0,r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],8:[function(e,t,r){"use strict";r.__esModule=!0;var n,o=e("../core-js/object/define-property"),i=(n=o)&&n.__esModule?n:{default:n};r.default=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}()},{"../core-js/object/define-property":5}],9:[function(e,t,r){"use strict";r.__esModule=!0;var n,o=e("../core-js/object/assign"),i=(n=o)&&n.__esModule?n:{default:n};r.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},{"../core-js/object/assign":4}],10:[function(e,t,r){var n,o;n=this,o=function(){var S=!0;function a(r){function e(e){var t=r.match(e);return t&&1<t.length&&t[1]||""}function t(e){var t=r.match(e);return t&&1<t.length&&t[2]||""}var n,o=e(/(ipod|iphone|ipad)/i).toLowerCase(),i=!/like android/i.test(r)&&/android/i.test(r),a=/nexus\s*[0-6]\s*/i.test(r),s=!a&&/nexus\s*[0-9]+/i.test(r),c=/CrOS/.test(r),u=/silk/i.test(r),d=/sailfish/i.test(r),l=/tizen/i.test(r),f=/(web|hpw)os/i.test(r),p=/windows phone/i.test(r),m=(/SamsungBrowser/i.test(r),!p&&/windows/i.test(r)),h=!o&&!u&&/macintosh/i.test(r),v=!i&&!d&&!l&&!f&&/linux/i.test(r),y=t(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),g=e(/version\/(\d+(\.\d+)?)/i),_=/tablet/i.test(r)&&!/tablet pc/i.test(r),b=!_&&/[^-]mobi/i.test(r),w=/xbox/i.test(r);/opera/i.test(r)?n={name:"Opera",opera:S,version:g||e(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(r)?n={name:"Opera",opera:S,version:e(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||g}:/SamsungBrowser/i.test(r)?n={name:"Samsung Internet for Android",samsungBrowser:S,version:g||e(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(r)?n={name:"Opera Coast",coast:S,version:g||e(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(r)?n={name:"Yandex Browser",yandexbrowser:S,version:g||e(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(r)?n={name:"UC Browser",ucbrowser:S,version:e(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(r)?n={name:"Maxthon",maxthon:S,version:e(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(r)?n={name:"Epiphany",epiphany:S,version:e(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(r)?n={name:"Puffin",puffin:S,version:e(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(r)?n={name:"Sleipnir",sleipnir:S,version:e(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(r)?n={name:"K-Meleon",kMeleon:S,version:e(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:p?(n={name:"Windows Phone",osname:"Windows Phone",windowsphone:S},y?(n.msedge=S,n.version=y):(n.msie=S,n.version=e(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(r)?n={name:"Internet Explorer",msie:S,version:e(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:c?n={name:"Chrome",osname:"Chrome OS",chromeos:S,chromeBook:S,chrome:S,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(r)?n={name:"Microsoft Edge",msedge:S,version:y}:/vivaldi/i.test(r)?n={name:"Vivaldi",vivaldi:S,version:e(/vivaldi\/(\d+(\.\d+)?)/i)||g}:d?n={name:"Sailfish",osname:"Sailfish OS",sailfish:S,version:e(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(r)?n={name:"SeaMonkey",seamonkey:S,version:e(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(r)?(n={name:"Firefox",firefox:S,version:e(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(r)&&(n.firefoxos=S,n.osname="Firefox OS")):u?n={name:"Amazon Silk",silk:S,version:e(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(r)?n={name:"PhantomJS",phantom:S,version:e(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(r)?n={name:"SlimerJS",slimer:S,version:e(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(r)||/rim\stablet/i.test(r)?n={name:"BlackBerry",osname:"BlackBerry OS",blackberry:S,version:g||e(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(n={name:"WebOS",osname:"WebOS",webos:S,version:g||e(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(r)&&(n.touchpad=S)):/bada/i.test(r)?n={name:"Bada",osname:"Bada",bada:S,version:e(/dolfin\/(\d+(\.\d+)?)/i)}:l?n={name:"Tizen",osname:"Tizen",tizen:S,version:e(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||g}:/qupzilla/i.test(r)?n={name:"QupZilla",qupzilla:S,version:e(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||g}:/chromium/i.test(r)?n={name:"Chromium",chromium:S,version:e(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||g}:/chrome|crios|crmo/i.test(r)?n={name:"Chrome",chrome:S,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:i?n={name:"Android",version:g}:/safari|applewebkit/i.test(r)?(n={name:"Safari",safari:S},g&&(n.version=g)):o?(n={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},g&&(n.version=g)):n=/googlebot/i.test(r)?{name:"Googlebot",googlebot:S,version:e(/googlebot\/(\d+(\.\d+))/i)||g}:{name:e(/^(.*)\/(.*) /),version:t(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(r)?(/(apple)?webkit\/537\.36/i.test(r)?(n.name=n.name||"Blink",n.blink=S):(n.name=n.name||"Webkit",n.webkit=S),!n.version&&g&&(n.version=g)):!n.opera&&/gecko\//i.test(r)&&(n.name=n.name||"Gecko",n.gecko=S,n.version=n.version||e(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||!i&&!n.silk?!n.windowsphone&&o?(n[o]=S,n.ios=S,n.osname="iOS"):h?(n.mac=S,n.osname="macOS"):w?(n.xbox=S,n.osname="Xbox"):m?(n.windows=S,n.osname="Windows"):v&&(n.linux=S,n.osname="Linux"):(n.android=S,n.osname="Android");var k="";n.windows?k=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(e(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?k=e(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?k=(k=e(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?k=(k=e(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):i?k=e(/android[ \/-](\d+(\.\d+)*)/i):n.webos?k=e(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?k=e(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?k=e(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(k=e(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(n.osversion=k);var P=!n.windows&&k.split(".")[0];return _||s||"ipad"==o||i&&(3==P||4<=P&&!b)||n.silk?n.tablet=S:(b||"iphone"==o||"ipod"==o||i||a||n.blackberry||n.webos||n.bada)&&(n.mobile=S),n.msedge||n.msie&&10<=n.version||n.yandexbrowser&&15<=n.version||n.vivaldi&&1<=n.version||n.chrome&&20<=n.version||n.samsungBrowser&&4<=n.version||n.firefox&&20<=n.version||n.safari&&6<=n.version||n.opera&&10<=n.version||n.ios&&n.osversion&&6<=n.osversion.split(".")[0]||n.blackberry&&10.1<=n.version||n.chromium&&20<=n.version?n.a=S:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=S:n.x=S,n}var s=a("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function c(e){for(var r=Math.max(n(e[0]),n(e[1])),t=o(e,function(e){var t=r-n(e);return o((e+=new Array(t+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});0<=--r;){if(t[0][r]>t[1][r])return 1;if(t[0][r]!==t[1][r])return-1;if(0===r)return 0}}function i(e,t,r){var n=s;"string"==typeof t&&(r=t,t=void 0),void 0===t&&(t=!1),r&&(n=a(r));var o=""+n.version;for(var i in e)if(e.hasOwnProperty(i)&&n[i]){if("string"!=typeof e[i])throw new Error("Browser version in the minVersion map should be a string: "+i+": "+String(e));return c([o,e[i]])<0}return t}return s.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in s)return!0}return!1},s.isUnsupportedBrowser=i,s.compareVersions=c,s.check=function(e,t,r){return!i(e,t,r)},s._detect=a,s.detect=a,s},void 0!==t&&t.exports?t.exports=o():"function"==typeof define&&define.amd?define("bowser",o):n.bowser=o()},{}],11:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":31,"../../modules/es6.array.from":95,"../../modules/es6.string.iterator":102}],12:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":94,"../modules/es6.string.iterator":102,"../modules/web.dom.iterable":108}],13:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":31,"../modules/es6.map":97,"../modules/es6.object.to-string":100,"../modules/es6.string.iterator":102,"../modules/es7.map.from":103,"../modules/es7.map.of":104,"../modules/es7.map.to-json":105,"../modules/web.dom.iterable":108}],14:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":31,"../../modules/es6.object.assign":98}],15:[function(e,t,r){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,r){return n.defineProperty(e,t,r)}},{"../../modules/_core":31,"../../modules/es6.object.define-property":99}],16:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":31,"../modules/es6.object.to-string":100,"../modules/es6.promise":101,"../modules/es6.string.iterator":102,"../modules/es7.promise.finally":106,"../modules/es7.promise.try":107,"../modules/web.dom.iterable":108}],17:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],18:[function(e,t,r){t.exports=function(){}},{}],19:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],20:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":50}],21:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":40}],22:[function(e,t,r){var c=e("./_to-iobject"),u=e("./_to-length"),d=e("./_to-absolute-index");t.exports=function(s){return function(e,t,r){var n,o=c(e),i=u(o.length),a=d(r,i);if(s&&t!=t){for(;a<i;)if((n=o[a++])!=n)return!0}else for(;a<i;a++)if((s||a in o)&&o[a]===t)return s||a||0;return!s&&-1}}},{"./_to-absolute-index":84,"./_to-iobject":86,"./_to-length":87}],23:[function(e,t,r){var _=e("./_ctx"),b=e("./_iobject"),w=e("./_to-object"),k=e("./_to-length"),n=e("./_array-species-create");t.exports=function(l,e){var f=1==l,p=2==l,m=3==l,h=4==l,v=6==l,y=5==l||v,g=e||n;return function(e,t,r){for(var n,o,i=w(e),a=b(i),s=_(t,r,3),c=k(a.length),u=0,d=f?g(e,c):p?g(e,0):void 0;u<c;u++)if((y||u in a)&&(o=s(n=a[u],u,i),l))if(f)d[u]=o;else if(o)switch(l){case 3:return!0;case 5:return n;case 6:return u;case 2:d.push(n)}else if(h)return!1;return v?-1:m||h?h:d}}},{"./_array-species-create":25,"./_ctx":33,"./_iobject":47,"./_to-length":87,"./_to-object":88}],24:[function(e,t,r){var n=e("./_is-object"),o=e("./_is-array"),i=e("./_wks")("species");t.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":49,"./_is-object":50,"./_wks":92}],25:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":24}],26:[function(e,t,r){var o=e("./_cof"),i=e("./_wks")("toStringTag"),a="Arguments"==o(function(){return arguments}());t.exports=function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:a?o(t):"Object"==(n=o(t))&&"function"==typeof t.callee?"Arguments":n}},{"./_cof":27,"./_wks":92}],27:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],28:[function(e,t,r){"use strict";var a=e("./_object-dp").f,s=e("./_object-create"),c=e("./_redefine-all"),u=e("./_ctx"),d=e("./_an-instance"),l=e("./_for-of"),n=e("./_iter-define"),o=e("./_iter-step"),i=e("./_set-species"),f=e("./_descriptors"),p=e("./_meta").fastKey,m=e("./_validate-collection"),h=f?"_s":"size",v=function(e,t){var r,n=p(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};t.exports={getConstructor:function(e,i,r,n){var o=e(function(e,t){d(e,o,i,"_i"),e._t=i,e._i=s(null),e._f=void 0,e._l=void 0,e[h]=0,null!=t&&l(t,r,e[n],e)});return c(o.prototype,{clear:function(){for(var e=m(this,i),t=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete t[r.i];e._f=e._l=void 0,e[h]=0},delete:function(e){var t=m(this,i),r=v(t,e);if(r){var n=r.n,o=r.p;delete t._i[r.i],r.r=!0,o&&(o.n=n),n&&(n.p=o),t._f==r&&(t._f=n),t._l==r&&(t._l=o),t[h]--}return!!r},forEach:function(e){m(this,i);for(var t,r=u(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.n:this._f;)for(r(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!v(m(this,i),e)}}),f&&a(o.prototype,"size",{get:function(){return m(this,i)[h]}}),o},def:function(e,t,r){var n,o,i=v(e,t);return i?i.v=r:(e._l=i={i:o=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=i),n&&(n.n=i),e[h]++,"F"!==o&&(e._i[o]=i)),e},getEntry:v,setStrong:function(e,r,t){n(e,r,function(e,t){this._t=m(e,r),this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,r=e._l;r&&r.r;)r=r.p;return e._t&&(e._l=r=r?r.n:e._t._f)?o(0,"keys"==t?r.k:"values"==t?r.v:[r.k,r.v]):(e._t=void 0,o(1))},t?"entries":"values",!t,!0),i(r)}}},{"./_an-instance":19,"./_ctx":33,"./_descriptors":35,"./_for-of":40,"./_iter-define":53,"./_iter-step":55,"./_meta":58,"./_object-create":62,"./_object-dp":63,"./_redefine-all":73,"./_set-species":77,"./_validate-collection":91}],29:[function(e,t,r){var n=e("./_classof"),o=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return o(this)}}},{"./_array-from-iterable":21,"./_classof":26}],30:[function(e,t,r){"use strict";var l=e("./_global"),f=e("./_export"),p=e("./_meta"),m=e("./_fails"),h=e("./_hide"),v=e("./_redefine-all"),y=e("./_for-of"),g=e("./_an-instance"),_=e("./_is-object"),b=e("./_set-to-string-tag"),w=e("./_object-dp").f,k=e("./_array-methods")(0),P=e("./_descriptors");t.exports=function(r,e,t,n,o,i){var a=l[r],s=a,c=o?"set":"add",u=s&&s.prototype,d={};return P&&"function"==typeof s&&(i||u.forEach&&!m(function(){(new s).entries().next()}))?(s=e(function(e,t){g(e,s,r,"_c"),e._c=new a,null!=t&&y(t,o,e[c],e)}),k("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(n){var o="add"==n||"set"==n;n in u&&(!i||"clear"!=n)&&h(s.prototype,n,function(e,t){if(g(this,s,n),!o&&i&&!_(e))return"get"==n&&void 0;var r=this._c[n](0===e?0:e,t);return o?this:r})}),i||w(s.prototype,"size",{get:function(){return this._c.size}})):(s=n.getConstructor(e,r,o,c),v(s.prototype,t),p.NEED=!0),b(s,r),d[r]=s,f(f.G+f.W+f.F,d),i||n.setStrong(s,r,o),s}},{"./_an-instance":19,"./_array-methods":23,"./_descriptors":35,"./_export":38,"./_fails":39,"./_for-of":40,"./_global":41,"./_hide":43,"./_is-object":50,"./_meta":58,"./_object-dp":63,"./_redefine-all":73,"./_set-to-string-tag":78}],31:[function(e,t,r){var n=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=n)},{}],32:[function(e,t,r){"use strict";var n=e("./_object-dp"),o=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,o(0,r)):e[t]=r}},{"./_object-dp":63,"./_property-desc":72}],33:[function(e,t,r){var i=e("./_a-function");t.exports=function(n,o,e){if(i(n),void 0===o)return n;switch(e){case 1:return function(e){return n.call(o,e)};case 2:return function(e,t){return n.call(o,e,t)};case 3:return function(e,t,r){return n.call(o,e,t,r)}}return function(){return n.apply(o,arguments)}}},{"./_a-function":17}],34:[function(e,t,r){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],35:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":39}],36:[function(e,t,r){var n=e("./_is-object"),o=e("./_global").document,i=n(o)&&n(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./_global":41,"./_is-object":50}],37:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],38:[function(e,t,r){var h=e("./_global"),v=e("./_core"),y=e("./_ctx"),g=e("./_hide"),_=e("./_has"),b="prototype",w=function(e,t,r){var n,o,i,a=e&w.F,s=e&w.G,c=e&w.S,u=e&w.P,d=e&w.B,l=e&w.W,f=s?v:v[t]||(v[t]={}),p=f[b],m=s?h:c?h[t]:(h[t]||{})[b];for(n in s&&(r=t),r)(o=!a&&m&&void 0!==m[n])&&_(f,n)||(i=o?m[n]:r[n],f[n]=s&&"function"!=typeof m[n]?r[n]:d&&o?y(i,h):l&&m[n]==i?function(n){var e=function(e,t,r){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,t)}return new n(e,t,r)}return n.apply(this,arguments)};return e[b]=n[b],e}(i):u&&"function"==typeof i?y(Function.call,i):i,u&&((f.virtual||(f.virtual={}))[n]=i,e&w.R&&p&&!p[n]&&g(p,n,i)))};w.F=1,w.G=2,w.S=4,w.P=8,w.B=16,w.W=32,w.U=64,w.R=128,t.exports=w},{"./_core":31,"./_ctx":33,"./_global":41,"./_has":42,"./_hide":43}],39:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],40:[function(e,t,r){var f=e("./_ctx"),p=e("./_iter-call"),m=e("./_is-array-iter"),h=e("./_an-object"),v=e("./_to-length"),y=e("./core.get-iterator-method"),g={},_={};(r=t.exports=function(e,t,r,n,o){var i,a,s,c,u=o?function(){return e}:y(e),d=f(r,n,t?2:1),l=0;if("function"!=typeof u)throw TypeError(e+" is not iterable!");if(m(u)){for(i=v(e.length);l<i;l++)if((c=t?d(h(a=e[l])[0],a[1]):d(e[l]))===g||c===_)return c}else for(s=u.call(e);!(a=s.next()).done;)if((c=p(s,d,a.value,t))===g||c===_)return c}).BREAK=g,r.RETURN=_},{"./_an-object":20,"./_ctx":33,"./_is-array-iter":48,"./_iter-call":51,"./_to-length":87,"./core.get-iterator-method":93}],41:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],42:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],43:[function(e,t,r){var n=e("./_object-dp"),o=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":35,"./_object-dp":63,"./_property-desc":72}],44:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":41}],45:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":35,"./_dom-create":36,"./_fails":39}],46:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],47:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":27}],48:[function(e,t,r){var n=e("./_iterators"),o=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||i[o]===e)}},{"./_iterators":56,"./_wks":92}],49:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":27}],50:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],51:[function(e,t,r){var i=e("./_an-object");t.exports=function(t,e,r,n){try{return n?e(i(r)[0],r[1]):e(r)}catch(e){var o=t.return;throw void 0!==o&&i(o.call(t)),e}}},{"./_an-object":20}],52:[function(e,t,r){"use strict";var n=e("./_object-create"),o=e("./_property-desc"),i=e("./_set-to-string-tag"),a={};e("./_hide")(a,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(a,{next:o(1,r)}),i(e,t+" Iterator")}},{"./_hide":43,"./_object-create":62,"./_property-desc":72,"./_set-to-string-tag":78,"./_wks":92}],53:[function(e,t,r){"use strict";var _=e("./_library"),b=e("./_export"),w=e("./_redefine"),k=e("./_hide"),P=e("./_iterators"),S=e("./_iter-create"),T=e("./_set-to-string-tag"),R=e("./_object-gpo"),C=e("./_wks")("iterator"),x=!([].keys&&"next"in[].keys()),E="values",j=function(){return this};t.exports=function(e,t,r,n,o,i,a){S(r,t,n);var s,c,u,d=function(e){if(!x&&e in m)return m[e];switch(e){case"keys":case E:return function(){return new r(this,e)}}return function(){return new r(this,e)}},l=t+" Iterator",f=o==E,p=!1,m=e.prototype,h=m[C]||m["@@iterator"]||o&&m[o],v=h||d(o),y=o?f?d("entries"):v:void 0,g="Array"==t&&m.entries||h;if(g&&(u=R(g.call(new e)))!==Object.prototype&&u.next&&(T(u,l,!0),_||"function"==typeof u[C]||k(u,C,j)),f&&h&&h.name!==E&&(p=!0,v=function(){return h.call(this)}),_&&!a||!x&&!p&&m[C]||k(m,C,v),P[t]=v,P[l]=j,o)if(s={values:f?v:d(E),keys:i?v:d("keys"),entries:y},a)for(c in s)c in m||w(m,c,s[c]);else b(b.P+b.F*(x||p),t,s);return s}},{"./_export":38,"./_hide":43,"./_iter-create":52,"./_iterators":56,"./_library":57,"./_object-gpo":66,"./_redefine":74,"./_set-to-string-tag":78,"./_wks":92}],54:[function(e,t,r){var i=e("./_wks")("iterator"),a=!1;try{var n=[7][i]();n.return=function(){a=!0},Array.from(n,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!a)return!1;var r=!1;try{var n=[7],o=n[i]();o.next=function(){return{done:r=!0}},n[i]=function(){return o},e(n)}catch(e){}return r}},{"./_wks":92}],55:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],56:[function(e,t,r){t.exports={}},{}],57:[function(e,t,r){t.exports=!0},{}],58:[function(e,t,r){var n=e("./_uid")("meta"),o=e("./_is-object"),i=e("./_has"),a=e("./_object-dp").f,s=0,c=Object.isExtensible||function(){return!0},u=!e("./_fails")(function(){return c(Object.preventExtensions({}))}),d=function(e){a(e,n,{value:{i:"O"+ ++s,w:{}}})},l=t.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,n)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[n].i},getWeak:function(e,t){if(!i(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return u&&l.NEED&&c(e)&&!i(e,n)&&d(e),e}}},{"./_fails":39,"./_has":42,"./_is-object":50,"./_object-dp":63,"./_uid":90}],59:[function(e,t,r){var s=e("./_global"),c=e("./_task").set,u=s.MutationObserver||s.WebKitMutationObserver,d=s.process,l=s.Promise,f="process"==e("./_cof")(d);t.exports=function(){var r,n,o,e=function(){var e,t;for(f&&(e=d.domain)&&e.exit();r;){t=r.fn,r=r.next;try{t()}catch(e){throw r?o():n=void 0,e}}n=void 0,e&&e.enter()};if(f)o=function(){d.nextTick(e)};else if(!u||s.navigator&&s.navigator.standalone)if(l&&l.resolve){var t=l.resolve();o=function(){t.then(e)}}else o=function(){c.call(s,e)};else{var i=!0,a=document.createTextNode("");new u(e).observe(a,{characterData:!0}),o=function(){a.data=i=!i}}return function(e){var t={fn:e,next:void 0};n&&(n.next=t),r||(r=t,o()),n=t}}},{"./_cof":27,"./_global":41,"./_task":83}],60:[function(e,t,r){"use strict";var o=e("./_a-function");function n(e){var r,n;this.promise=new e(function(e,t){if(void 0!==r||void 0!==n)throw TypeError("Bad Promise constructor");r=e,n=t}),this.resolve=o(r),this.reject=o(n)}t.exports.f=function(e){return new n(e)}},{"./_a-function":17}],61:[function(e,t,r){"use strict";var f=e("./_object-keys"),p=e("./_object-gops"),m=e("./_object-pie"),h=e("./_to-object"),v=e("./_iobject"),o=Object.assign;t.exports=!o||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=o({},e)[r]||Object.keys(o({},t)).join("")!=n})?function(e,t){for(var r=h(e),n=arguments.length,o=1,i=p.f,a=m.f;o<n;)for(var s,c=v(arguments[o++]),u=i?f(c).concat(i(c)):f(c),d=u.length,l=0;l<d;)a.call(c,s=u[l++])&&(r[s]=c[s]);return r}:o},{"./_fails":39,"./_iobject":47,"./_object-gops":65,"./_object-keys":68,"./_object-pie":69,"./_to-object":88}],62:[function(n,e,t){var o=n("./_an-object"),i=n("./_object-dps"),a=n("./_enum-bug-keys"),s=n("./_shared-key")("IE_PROTO"),c=function(){},u="prototype",d=function(){var e,t=n("./_dom-create")("iframe"),r=a.length;for(t.style.display="none",n("./_html").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),d=e.F;r--;)delete d[u][a[r]];return d()};e.exports=Object.create||function(e,t){var r;return null!==e?(c[u]=o(e),r=new c,c[u]=null,r[s]=e):r=d(),void 0===t?r:i(r,t)}},{"./_an-object":20,"./_dom-create":36,"./_enum-bug-keys":37,"./_html":44,"./_object-dps":64,"./_shared-key":79}],63:[function(e,t,r){var n=e("./_an-object"),o=e("./_ie8-dom-define"),i=e("./_to-primitive"),a=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),o)try{return a(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":20,"./_descriptors":35,"./_ie8-dom-define":45,"./_to-primitive":89}],64:[function(e,t,r){var a=e("./_object-dp"),s=e("./_an-object"),c=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){s(e);for(var r,n=c(t),o=n.length,i=0;i<o;)a.f(e,r=n[i++],t[r]);return e}},{"./_an-object":20,"./_descriptors":35,"./_object-dp":63,"./_object-keys":68}],65:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],66:[function(e,t,r){var n=e("./_has"),o=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=o(e),n(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},{"./_has":42,"./_shared-key":79,"./_to-object":88}],67:[function(e,t,r){var a=e("./_has"),s=e("./_to-iobject"),c=e("./_array-includes")(!1),u=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,n=s(e),o=0,i=[];for(r in n)r!=u&&a(n,r)&&i.push(r);for(;t.length>o;)a(n,r=t[o++])&&(~c(i,r)||i.push(r));return i}},{"./_array-includes":22,"./_has":42,"./_shared-key":79,"./_to-iobject":86}],68:[function(e,t,r){var n=e("./_object-keys-internal"),o=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,o)}},{"./_enum-bug-keys":37,"./_object-keys-internal":67}],69:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],70:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],71:[function(e,t,r){var n=e("./_an-object"),o=e("./_is-object"),i=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),o(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":20,"./_is-object":50,"./_new-promise-capability":60}],72:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],73:[function(e,t,r){var o=e("./_hide");t.exports=function(e,t,r){for(var n in t)r&&e[n]?e[n]=t[n]:o(e,n,t[n]);return e}},{"./_hide":43}],74:[function(e,t,r){t.exports=e("./_hide")},{"./_hide":43}],75:[function(e,t,r){"use strict";var n=e("./_export"),a=e("./_a-function"),s=e("./_ctx"),c=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,o,i=arguments[1];return a(this),(t=void 0!==i)&&a(i),null==e?new this:(r=[],t?(n=0,o=s(i,arguments[2],2),c(e,!1,function(e){r.push(o(e,n++))})):c(e,!1,r.push,r),new this(r))}})}},{"./_a-function":17,"./_ctx":33,"./_export":38,"./_for-of":40}],76:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":38}],77:[function(e,t,r){"use strict";var n=e("./_global"),o=e("./_core"),i=e("./_object-dp"),a=e("./_descriptors"),s=e("./_wks")("species");t.exports=function(e){var t="function"==typeof o[e]?o[e]:n[e];a&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},{"./_core":31,"./_descriptors":35,"./_global":41,"./_object-dp":63,"./_wks":92}],78:[function(e,t,r){var n=e("./_object-dp").f,o=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,i)&&n(e,i,{configurable:!0,value:t})}},{"./_has":42,"./_object-dp":63,"./_wks":92}],79:[function(e,t,r){var n=e("./_shared")("keys"),o=e("./_uid");t.exports=function(e){return n[e]||(n[e]=o(e))}},{"./_shared":80,"./_uid":90}],80:[function(e,t,r){var n=e("./_global"),o="__core-js_shared__",i=n[o]||(n[o]={});t.exports=function(e){return i[e]||(i[e]={})}},{"./_global":41}],81:[function(e,t,r){var o=e("./_an-object"),i=e("./_a-function"),a=e("./_wks")("species");t.exports=function(e,t){var r,n=o(e).constructor;return void 0===n||null==(r=o(n)[a])?t:i(r)}},{"./_a-function":17,"./_an-object":20,"./_wks":92}],82:[function(e,t,r){var c=e("./_to-integer"),u=e("./_defined");t.exports=function(s){return function(e,t){var r,n,o=String(u(e)),i=c(t),a=o.length;return i<0||a<=i?s?"":void 0:(r=o.charCodeAt(i))<55296||56319<r||i+1===a||(n=o.charCodeAt(i+1))<56320||57343<n?s?o.charAt(i):r:s?o.slice(i,i+2):n-56320+(r-55296<<10)+65536}}},{"./_defined":34,"./_to-integer":85}],83:[function(e,t,r){var n,o,i,a=e("./_ctx"),s=e("./_invoke"),c=e("./_html"),u=e("./_dom-create"),d=e("./_global"),l=d.process,f=d.setImmediate,p=d.clearImmediate,m=d.MessageChannel,h=d.Dispatch,v=0,y={},g="onreadystatechange",_=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},b=function(e){_.call(e.data)};f&&p||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return y[++v]=function(){s("function"==typeof e?e:Function(e),t)},n(v),v},p=function(e){delete y[e]},"process"==e("./_cof")(l)?n=function(e){l.nextTick(a(_,e,1))}:h&&h.now?n=function(e){h.now(a(_,e,1))}:m?(i=(o=new m).port2,o.port1.onmessage=b,n=a(i.postMessage,i,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+"","*")},d.addEventListener("message",b,!1)):n=g in u("script")?function(e){c.appendChild(u("script"))[g]=function(){c.removeChild(this),_.call(e)}}:function(e){setTimeout(a(_,e,1),0)}),t.exports={set:f,clear:p}},{"./_cof":27,"./_ctx":33,"./_dom-create":36,"./_global":41,"./_html":44,"./_invoke":46}],84:[function(e,t,r){var n=e("./_to-integer"),o=Math.max,i=Math.min;t.exports=function(e,t){return(e=n(e))<0?o(e+t,0):i(e,t)}},{"./_to-integer":85}],85:[function(e,t,r){var n=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(0<e?o:n)(e)}},{}],86:[function(e,t,r){var n=e("./_iobject"),o=e("./_defined");t.exports=function(e){return n(o(e))}},{"./_defined":34,"./_iobject":47}],87:[function(e,t,r){var n=e("./_to-integer"),o=Math.min;t.exports=function(e){return 0<e?o(n(e),9007199254740991):0}},{"./_to-integer":85}],88:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":34}],89:[function(e,t,r){var o=e("./_is-object");t.exports=function(e,t){if(!o(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!o(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!o(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!o(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":50}],90:[function(e,t,r){var n=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},{}],91:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":50}],92:[function(e,t,r){var n=e("./_shared")("wks"),o=e("./_uid"),i=e("./_global").Symbol,a="function"==typeof i;(t.exports=function(e){return n[e]||(n[e]=a&&i[e]||(a?i:o)("Symbol."+e))}).store=n},{"./_global":41,"./_shared":80,"./_uid":90}],93:[function(e,t,r){var n=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||i[n(e)]}},{"./_classof":26,"./_core":31,"./_iterators":56,"./_wks":92}],94:[function(e,t,r){var n=e("./_an-object"),o=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":20,"./_core":31,"./core.get-iterator-method":93}],95:[function(e,t,r){"use strict";var f=e("./_ctx"),n=e("./_export"),p=e("./_to-object"),m=e("./_iter-call"),h=e("./_is-array-iter"),v=e("./_to-length"),y=e("./_create-property"),g=e("./core.get-iterator-method");n(n.S+n.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,n,o,i=p(e),a="function"==typeof this?this:Array,s=arguments.length,c=1<s?arguments[1]:void 0,u=void 0!==c,d=0,l=g(i);if(u&&(c=f(c,2<s?arguments[2]:void 0,2)),null==l||a==Array&&h(l))for(r=new a(t=v(i.length));d<t;d++)y(r,d,u?c(i[d],d):i[d]);else for(o=l.call(i),r=new a;!(n=o.next()).done;d++)y(r,d,u?m(o,c,[n.value,d],!0):n.value);return r.length=d,r}})},{"./_create-property":32,"./_ctx":33,"./_export":38,"./_is-array-iter":48,"./_iter-call":51,"./_iter-detect":54,"./_to-length":87,"./_to-object":88,"./core.get-iterator-method":93}],96:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),o=e("./_iter-step"),i=e("./_iterators"),a=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),i.Arguments=i.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":18,"./_iter-define":53,"./_iter-step":55,"./_iterators":56,"./_to-iobject":86}],97:[function(e,t,r){"use strict";var n=e("./_collection-strong"),o=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(o(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(o(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":30,"./_collection-strong":28,"./_validate-collection":91}],98:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":38,"./_object-assign":61}],99:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":35,"./_export":38,"./_object-dp":63}],100:[function(e,t,r){},{}],101:[function(r,e,t){"use strict";var n,o,i,a,s=r("./_library"),c=r("./_global"),u=r("./_ctx"),d=r("./_classof"),l=r("./_export"),f=r("./_is-object"),p=r("./_a-function"),m=r("./_an-instance"),h=r("./_for-of"),v=r("./_species-constructor"),y=r("./_task").set,g=r("./_microtask")(),_=r("./_new-promise-capability"),b=r("./_perform"),w=r("./_promise-resolve"),k="Promise",P=c.TypeError,S=c.process,T=c[k],R="process"==d(S),C=function(){},x=o=_.f,E=!!function(){try{var e=T.resolve(1),t=(e.constructor={})[r("./_wks")("species")]=function(e){e(C,C)};return(R||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t}catch(e){}}(),j=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},O=function(d,r){if(!d._n){d._n=!0;var n=d._c;g(function(){for(var c=d._v,u=1==d._s,e=0,t=function(e){var t,r,n,o=u?e.ok:e.fail,i=e.resolve,a=e.reject,s=e.domain;try{o?(u||(2==d._h&&I(d),d._h=1),!0===o?t=c:(s&&s.enter(),t=o(c),s&&(s.exit(),n=!0)),t===e.promise?a(P("Promise-chain cycle")):(r=j(t))?r.call(t,i,a):i(t)):a(c)}catch(e){s&&!n&&s.exit(),a(e)}};n.length>e;)t(n[e++]);d._c=[],d._n=!1,r&&!d._h&&M(d)})}},M=function(i){y.call(c,function(){var e,t,r,n=i._v,o=L(i);if(o&&(e=b(function(){R?S.emit("unhandledRejection",n,i):(t=c.onunhandledrejection)?t({promise:i,reason:n}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",n)}),i._h=R||L(i)?2:1),i._a=void 0,o&&e.e)throw e.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},I=function(t){y.call(c,function(){var e;R?S.emit("rejectionHandled",t):(e=c.onrejectionhandled)&&e({promise:t,reason:t._v})})},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},A=function(e){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw P("Promise can't be resolved itself");(r=j(e))?g(function(){var t={_w:n,_d:!1};try{r.call(e,u(A,t,1),u(D,t,1))}catch(e){D.call(t,e)}}):(n._v=e,n._s=1,O(n,!1))}catch(e){D.call({_w:n,_d:!1},e)}}};E||(T=function(e){m(this,T,k,"_h"),p(e),n.call(this);try{e(u(A,this,1),u(D,this,1))}catch(e){D.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r("./_redefine-all")(T.prototype,{then:function(e,t){var r=x(v(this,T));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=R?S.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n;this.promise=e,this.resolve=u(A,e,1),this.reject=u(D,e,1)},_.f=x=function(e){return e===T||e===a?new i(e):o(e)}),l(l.G+l.W+l.F*!E,{Promise:T}),r("./_set-to-string-tag")(T,k),r("./_set-species")(k),a=r("./_core")[k],l(l.S+l.F*!E,k,{reject:function(e){var t=x(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!E),k,{resolve:function(e){return w(s&&this===a?T:this,e)}}),l(l.S+l.F*!(E&&r("./_iter-detect")(function(e){T.all(e).catch(C)})),k,{all:function(e){var a=this,t=x(a),s=t.resolve,c=t.reject,r=b(function(){var n=[],o=0,i=1;h(e,!1,function(e){var t=o++,r=!1;n.push(void 0),i++,a.resolve(e).then(function(e){r||(r=!0,n[t]=e,--i||s(n))},c)}),--i||s(n)});return r.e&&c(r.v),t.promise},race:function(e){var t=this,r=x(t),n=r.reject,o=b(function(){h(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return o.e&&n(o.v),r.promise}})},{"./_a-function":17,"./_an-instance":19,"./_classof":26,"./_core":31,"./_ctx":33,"./_export":38,"./_for-of":40,"./_global":41,"./_is-object":50,"./_iter-detect":54,"./_library":57,"./_microtask":59,"./_new-promise-capability":60,"./_perform":70,"./_promise-resolve":71,"./_redefine-all":73,"./_set-species":77,"./_set-to-string-tag":78,"./_species-constructor":81,"./_task":83,"./_wks":92}],102:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":53,"./_string-at":82}],103:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":75}],104:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":76}],105:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":29,"./_export":38}],106:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_core"),i=e("./_global"),a=e("./_species-constructor"),s=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(t){var r=a(this,o.Promise||i.Promise),e="function"==typeof t;return this.then(e?function(e){return s(r,t()).then(function(){return e})}:t,e?function(e){return s(r,t()).then(function(){throw e})}:t)}})},{"./_core":31,"./_export":38,"./_global":41,"./_promise-resolve":71,"./_species-constructor":81}],107:[function(e,t,r){"use strict";var n=e("./_export"),o=e("./_new-promise-capability"),i=e("./_perform");n(n.S,"Promise",{try:function(e){var t=o.f(this),r=i(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":38,"./_new-promise-capability":60,"./_perform":70}],108:[function(e,t,r){e("./es6.array.iterator");for(var n=e("./_global"),o=e("./_hide"),i=e("./_iterators"),a=e("./_wks")("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],d=n[u],l=d&&d.prototype;l&&!l[a]&&o(l,a,u),i[u]=i.Array}},{"./_global":41,"./_hide":43,"./_iterators":56,"./_wks":92,"./es6.array.iterator":96}],109:[function(r,n,i){(function(t){function e(){var e;try{e=i.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(i=n.exports=r("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},i.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+i.humanize(this.diff),!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))}),e.splice(o,0,r)},i.save=function(e){try{null==e?i.storage.removeItem("debug"):i.storage.debug=e}catch(e){}},i.load=e,i.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},i.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],i.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},i.enable(e())}).call(this,r("_process"))},{"./debug":110,_process:136}],110:[function(e,t,c){function r(e){var n;function s(){if(s.enabled){var o=s,e=+new Date,t=e-(n||e);o.diff=t,o.prev=n,o.curr=e,n=e;for(var i=new Array(arguments.length),r=0;r<i.length;r++)i[r]=arguments[r];i[0]=c.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var a=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;a++;var r=c.formatters[t];if("function"==typeof r){var n=i[a];e=r.call(o,n),i.splice(a,1),a--}return e}),c.formatArgs.call(o,i),(s.log||c.log||console.log.bind(console)).apply(o,i)}}return s.namespace=e,s.enabled=c.enabled(e),s.useColors=c.useColors(),s.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return c.colors[Math.abs(r)%c.colors.length]}(e),s.destroy=o,"function"==typeof c.init&&c.init(s),c.instances.push(s),s}function o(){var e=c.instances.indexOf(this);return-1!==e&&(c.instances.splice(e,1),!0)}(c=t.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},c.disable=function(){c.enable("")},c.enable=function(e){var t;c.save(e),c.names=[],c.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?c.skips.push(new RegExp("^"+e.substr(1)+"$")):c.names.push(new RegExp("^"+e+"$")));for(t=0;t<c.instances.length;t++){var o=c.instances[t];o.enabled=c.enabled(o.namespace)}},c.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=c.skips.length;t<r;t++)if(c.skips[t].test(e))return!1;for(t=0,r=c.names.length;t<r;t++)if(c.names[t].test(e))return!0;return!1},c.humanize=e("ms"),c.instances=[],c.names=[],c.skips=[],c.formatters={}},{ms:135}],111:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function c(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function d(e){return void 0===e}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,o,i,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var s=new Error('Uncaught, unspecified "error" event. ('+t+")");throw s.context=t,s}if(d(r=this._events[e]))return!1;if(c(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(u(r))for(o=Array.prototype.slice.call(arguments,1),n=(a=r.slice()).length,i=0;i<n;i++)a[i].apply(this,o);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var r;if(!c(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,c(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&(r=d(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!c(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,o,i;if(!c(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,n=-1,r===t||c(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(u(r)){for(i=o;0<i--;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(c(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?c(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(c(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=e("events"),a=e("./Logger"),s=(n=a)&&n.__esModule?n:{default:n},c=e("./errors");var u=new s.default("CommandQueue"),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EventEmitter),o(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var n=this,o=Object.assign({method:e},t);return u.debug("push() [method:%s]",e),new Promise(function(e,t){var r=n._queue;o.resolve=e,o.reject=t,r.push(o),n._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(t){var r=this;if(u.debug("_handleCommand() [method:%s]",t.method),this._closed)return t.reject(new c.InvalidStateError("closed")),Promise.resolve();var e={promise:null};return this.emit("exec",t,e),Promise.resolve().then(function(){return e.promise}).then(function(e){u.debug("_handleCommand() | command succeeded [method:%s]",t.method),r._closed?t.reject(new c.InvalidStateError("closed")):t.resolve(e)}).catch(function(e){u.error("_handleCommand() | command failed [method:%s]: %o",t.method,e),t.reject(e)})}}]),t}();r.default=d},{"./Logger":116,"./errors":121,events:111}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=a(e("./Logger")),s=a(e("./EnhancedEventEmitter")),c=e("./errors");function a(e){return e&&e.__esModule?e:{default:e}}var u=new Set(["default","low","medium","high"]),d=1e3,l=new i.default("Consumer"),f=function(e){function a(e,t,r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,l));return i._id=e,i._closed=!1,i._kind=t,i._rtpParameters=r,i._peer=n,i._appData=o,i._supported=!1,i._transport=null,i._track=null,i._locallyPaused=!1,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=d,i._preferredProfile="default",i._effectiveProfile=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,s.default),o(a,[{key:"close",value:function(){l.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){l.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(t){var r=this;return l.debug("receive() [transport:%o]",t),this._closed?Promise.reject(new c.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===t?"undefined":n(t))?Promise.reject(new TypeError("invalid Transport")):(this._transport=t).addConsumer(this).then(function(e){return r._track=e,r.paused&&(e.enabled=!1),t.once("@close",function(){if(!r._closed&&r._transport===t){r._transport=null;try{r._track.stop()}catch(e){}r._track=null,r.safeEmit("unhandled")}}),r.safeEmit("handled"),r._statsEnabled&&t.enableConsumerStats(r,r._statsInterval),e}).catch(function(e){throw r._transport=null,e}):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return l.debug("pause()"),this._closed?(l.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){l.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return l.debug("resume()"),this._closed?(l.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){l.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){l.debug("setPreferredProfile() [profile:%s]",e),this._closed?l.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(u.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):l.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){l.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){l.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:d;l.debug("enableStats() [interval:%s]",e),this._closed?l.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?d:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){l.debug("disableStats()"),this._closed?l.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}]),a}();r.default=f},{"./EnhancedEventEmitter":115,"./Logger":116,"./errors":121}],114:[function(l,e,f){(function(n){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var e=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=r(l("bowser")),t=r(l("./Logger")),i=r(l("./handlers/Chrome55")),a=r(l("./handlers/Safari11")),s=r(l("./handlers/Firefox50")),c=r(l("./handlers/Edge11"));function r(e){return e&&e.__esModule?e:{default:e}}var u=new t.default("Device"),d=function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}return e(r,null,[{key:"isSupported",value:function(){return r._detected||r._detect(),Boolean(r._handlerClass)}},{key:"_detect",value:function(){if(r._detected=!0,n.navigator&&"string"==typeof n.navigator.userAgent){var e=n.navigator.userAgent,t=o.default.detect(e);r._flag=void 0,r._deviceName=t.name||"unknown device",r._version=t.version||"unknown",r._bowser=t,r._handlerClass=null,o.default.check({chrome:"55",chromium:"55"},!0,e)?(r._flag="chrome",r._handlerClass=i.default):o.default.check({firefox:"50"},!0,e)?(r._flag="firefox",r._handlerClass=s.default):o.default.check({safari:"11"},!0,e)?(r._flag="safari",r._handlerClass=a.default):o.default.check({msedge:"11"},!0,e)&&(r._flag="msedge",r._handlerClass=c.default),o.default.check({opera:"44"},!0,e)&&(r._flag="opera",r._handlerClass=i.default),r.isSupported()?u.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',r._flag,r._deviceName,r._version,r._handlerClass.name):u.warn("browser not supported [name:%s, version:%s]",r._deviceName,r._version)}else n.navigator&&"ReactNative"===n.navigator.product?(r._flag="react-native",r._deviceName="ReactNative",r._version="unknown",r._bowser={},r._handlerClass=i.default):u.warn("device not supported")}},{key:"flag",get:function(){return r._detected||r._detect(),r._flag}},{key:"deviceName",get:function(){return r._detected||r._detect(),r._deviceName}},{key:"version",get:function(){return r._detected||r._detect(),r._version}},{key:"bowser",get:function(){return r._detected||r._detect(),r._bowser}},{key:"Handler",get:function(){return r._detected||r._detect(),r._handlerClass}}]),r}();(f.default=d)._detected=!1,d._flag=void 0,d._deviceName=void 0,d._version=void 0,d._bowser=void 0,d._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":116,"./handlers/Chrome55":122,"./handlers/Edge11":123,"./handlers/Firefox50":124,"./handlers/Safari11":125,bowser:10}],115:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=e("events"),a=e("./Logger"),s=(n=a)&&n.__esModule?n:{default:n};var c=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.setMaxListeners(1/0),t._logger=e||new s.default("EnhancedEventEmitter"),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,i.EventEmitter),o(r,[{key:"safeEmit",value:function(t){try{for(var e=arguments.length,r=Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this.emit.apply(this,[t].concat(r))}catch(e){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e)}}},{key:"safeEmitAsPromise",value:function(n){for(var o=this,e=arguments.length,i=Array(1<e?e-1:0),t=1;t<e;t++)i[t-1]=arguments[t];return new Promise(function(t,r){o.safeEmit.apply(o,[n].concat(i,[function(e){t(e)},function(e){o._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",n,e),r(e)}]))})}}]),r}();r.default=c},{"./Logger":116,events:111}],116:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=e("debug"),a=(n=i)&&n.__esModule?n:{default:n};var s="mediasoup-client",c=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e?(this._debug=(0,a.default)(s+":"+e),this._warn=(0,a.default)(s+":WARN:"+e),this._error=(0,a.default)(s+":ERROR:"+e)):(this._debug=(0,a.default)(s),this._warn=(0,a.default)(s+":WARN"),this._error=(0,a.default)(s+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return o(t,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),t}();r.default=c},{debug:109}],117:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),n=a(e("./Logger")),i=a(e("./EnhancedEventEmitter"));function a(e){return e&&e.__esModule?e:{default:e}}var s=new n.default("Peer"),c=function(e){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,s));return r._name=e,r._closed=!1,r._appData=t,r._consumers=new Map,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i.default),o(n,[{key:"close",value:function(){if(s.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(s.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._consumers.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:"+e.id+"]");this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}]),n}();r.default=c},{"./EnhancedEventEmitter":115,"./Logger":116}],118:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=u(e("./Logger")),a=u(e("./EnhancedEventEmitter")),s=e("./errors"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils"));function u(e){return e&&e.__esModule?e:{default:e}}var d=1e3,l={low:1e5,medium:3e5,high:15e5},f=new o.default("Producer"),p=function(e){function o(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,f));return n._id=c.randomNumber(),n._closed=!1,n._originalTrack=e,n._track=e.clone(),n._appData=r,n._simulcast=!1,t.simulcast&&(n._simulcast=Object.assign({},l,t.simulcast)),n._transport=null,n._rtpParameters=null,n._locallyPaused=!n._track.enabled,n._remotelyPaused=!1,n._statsEnabled=!1,n._statsInterval=d,n._handleTrack(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,a.default),i(o,[{key:"close",value:function(e){f.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){f.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return f.debug("send() [transport:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":n(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e).addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e})}},{key:"pause",value:function(e){return f.debug("pause()"),this._closed?(f.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){f.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return f.debug("resume()"),this._closed?(f.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){f.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t=this;if(f.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new s.InvalidStateError("Producer closed"));if(!(e instanceof MediaStreamTrack))return Promise.reject(new TypeError("track is not a MediaStreamTrack"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));var r=e.clone();return Promise.resolve().then(function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)}).then(function(){try{t._track.onended=null,t._track.stop()}catch(e){}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:d;f.debug("enableStats() [interval:%s]",e),this._closed?f.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?d:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){f.debug("disableStats()"),this._closed?f.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(f.warn('track "ended" event, closing Producer'),e.safeEmit("trackended"),e.close())}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}]),o}();r.default=p},{"./EnhancedEventEmitter":115,"./Logger":116,"./errors":121,"./utils":134}],119:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),i=m(e("./Logger")),a=m(e("./EnhancedEventEmitter")),c=e("./errors"),u=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./ortc")),d=m(e("./Device")),s=m(e("./Transport")),l=m(e("./Producer")),f=m(e("./Peer")),p=m(e("./Consumer"));function m(e){return e&&e.__esModule?e:{default:e}}var v=new i.default("Room"),y={new:"new",joining:"joining",joined:"joined",closed:"closed"},h=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,v));if(v.debug("constructor() [options:%o]",e),!d.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},t._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||1e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[]},t._state=y.new,t._peerName=null,t._transports=new Map,t._producers=new Map,t._peers=new Map,t._extendedRtpCapabilities=null,t._canSendByKind={audio:!1,video:!1},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,a.default),o(r,[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,o){var s=this;if(v.debug('join() [peerName:"%s"]',e),"string"!=typeof e)return Promise.reject(new TypeError("invalid peerName"));if(this._state!==y.new&&this._state!==y.closed)return Promise.reject(new c.InvalidStateError('invalid state "'+this._state+'"'));this._peerName=e,this._state=y.joining;var i=void 0;return Promise.resolve().then(function(){return s._settings.roomSettings?void(i=s._settings.roomSettings):s._sendRequest("queryRoom",{target:"room"}).then(function(e){i=e,v.debug("join() | got Room settings:%o",i)})}).then(function(){return d.default.Handler.getNativeRtpCapabilities()}).then(function(e){v.debug("join() | native RTP capabilities:%o",e),s._extendedRtpCapabilities=u.getExtendedRtpCapabilities(e,i.rtpCapabilities),v.debug("join() | extended RTP capabilities:%o",s._extendedRtpCapabilities);var t=u.getUnsupportedCodecs(i.rtpCapabilities,i.mandatoryCodecPayloadTypes,s._extendedRtpCapabilities);if(0<t.length)throw v.error("%s mandatory room codecs not supported:%o",t.length,t),new c.UnsupportedError("mandatory room codecs not supported",t);s._canSendByKind.audio=u.canSend("audio",s._extendedRtpCapabilities),s._canSendByKind.video=u.canSend("video",s._extendedRtpCapabilities);var r=u.getRtpCapabilities(s._extendedRtpCapabilities);v.debug("join() | effective local RTP capabilities for receiving:%o",r);var n={target:"room",peerName:s._peerName,rtpCapabilities:r,appData:o};return s._sendRequest("join",n).then(function(e){return e.peers})}).then(function(e){var t=!0,r=!1,n=void 0;try{for(var o,i=(e||[])[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;try{s._handlePeerData(a)}catch(e){v.error("join() | error handling Peer:%o",e)}}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}return s._state=y.joined,v.debug("join() | joined the Room"),s.peers}).catch(function(e){throw s._state=y.new,e})}},{key:"leave",value:function(e){if(v.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=y.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._transports.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){u.value.close()}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,f=!1,p=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){m.value.close()}}catch(e){f=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(f)throw p}}}}},{key:"remoteClose",value:function(e){if(v.debug("remoteClose()"),!this.closed){this._state=y.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,i=this._transports.values()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){u.value.remoteClose()}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,f=!1,p=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){m.value.remoteClose()}}catch(e){f=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(f)throw p}}}}},{key:"canSend",value:function(e){if(!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'+e+'"');return this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var o=this;if(v.debug("createTransport() [direction:%s]",e),!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'+e+'"');var r=new s.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(r.id,r),r.on("@request",function(e,t,r,n){o._sendRequest(e,t).then(r).catch(n)}),r.on("@notify",function(e,t){o._sendNotification(e,t)}),r.on("@close",function(){o._transports.delete(r.id)}),r}},{key:"createProducer",value:function(e,t,r){var n=this;if(v.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');if(!(e instanceof MediaStreamTrack))throw new TypeError("track is not a MediaStreamTrack");if(!this._canSendByKind[e.kind])throw new Error("cannot send "+e.kind);if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new l.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(!this.joined)throw new c.InvalidStateError('invalid state "'+this._state+'"');var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.restartIce()}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"receiveNotification",value:function(ne){var oe=this;if(this.closed)return Promise.reject(new c.InvalidStateError("Room closed"));if("object"!==(void 0===ne?"undefined":n(ne)))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==ne.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof ne.method)return Promise.reject(new TypeError("wrong/missing notification method"));var ie=ne.method;return v.debug("receiveNotification() [method:%s, notification:%o]",ie,ne),Promise.resolve().then(function(){switch(ie){case"closed":var e=ne.appData;oe.remoteClose(e);break;case"transportClosed":var t=ne.id,r=ne.appData,n=oe._transports.get(t);if(!n)throw new Error('Transport not found [id:"'+t+'"]');n.remoteClose(r);break;case"transportStats":var o=ne.id,i=ne.stats,a=oe._transports.get(o);if(!a)throw new Error("transport not found [id:"+o+"]");a.remoteStats(i);break;case"newPeer":var s=ne.name;if(oe._peers.has(s))throw new Error('Peer already exists [name:"'+s+'"]');var c=ne;oe._handlePeerData(c);break;case"peerClosed":var u=ne.name,d=ne.appData,l=oe._peers.get(u);if(!l)throw new Error('no Peer found [name:"'+u+'"]');l.remoteClose(d);break;case"producerPaused":var f=ne.id,p=ne.appData,m=oe._producers.get(f);if(!m)throw new Error("Producer not found [id:"+f+"]");m.remotePause(p);break;case"producerResumed":var h=ne.id,v=ne.appData,y=oe._producers.get(h);if(!y)throw new Error("Producer not found [id:"+h+"]");y.remoteResume(v);break;case"producerClosed":var g=ne.id,_=ne.appData,b=oe._producers.get(g);if(!b)throw new Error("Producer not found [id:"+g+"]");b.remoteClose(_);break;case"producerStats":var w=ne.id,k=ne.stats,P=oe._producers.get(w);if(!P)throw new Error("Producer not found [id:"+w+"]");P.remoteStats(k);break;case"newConsumer":var S=ne.peerName,T=oe._peers.get(S);if(!T)throw new Error('no Peer found [name:"'+S+'"]');var R=ne;oe._handleConsumerData(R,T);break;case"consumerClosed":var C=ne.id,x=ne.peerName,E=ne.appData,j=oe._peers.get(x);if(!j)throw new Error('no Peer found [name:"'+x+'"]');var O=j.getConsumerById(C);if(!O)throw new Error("Consumer not found [id:"+C+"]");O.remoteClose(E);break;case"consumerPaused":var M=ne.id,L=ne.peerName,I=ne.appData,D=oe._peers.get(L);if(!D)throw new Error('no Peer found [name:"'+L+'"]');var A=D.getConsumerById(M);if(!A)throw new Error("Consumer not found [id:"+M+"]");A.remotePause(I);break;case"consumerResumed":var F=ne.id,N=ne.peerName,B=ne.appData,U=oe._peers.get(N);if(!U)throw new Error('no Peer found [name:"'+N+'"]');var V=U.getConsumerById(F);if(!V)throw new Error("Consumer not found [id:"+F+"]");V.remoteResume(B);break;case"consumerPreferredProfileSet":var z=ne.id,W=ne.peerName,q=ne.profile,G=oe._peers.get(W);if(!G)throw new Error('no Peer found [name:"'+W+'"]');var K=G.getConsumerById(z);if(!K)throw new Error("Consumer not found [id:"+z+"]");K.remoteSetPreferredProfile(q);break;case"consumerEffectiveProfileChanged":var H=ne.id,J=ne.peerName,Q=ne.profile,$=oe._peers.get(J);if(!$)throw new Error('no Peer found [name:"'+J+'"]');var X=$.getConsumerById(H);if(!X)throw new Error("Consumer not found [id:"+H+"]");X.remoteEffectiveProfileChanged(Q);break;case"consumerStats":var Y=ne.id,Z=ne.peerName,ee=ne.stats,te=oe._peers.get(Z);if(!te)throw new Error('no Peer found [name:"'+Z+'"]');var re=te.getConsumerById(Y);if(!re)throw new Error("Consumer not found [id:"+Y+"]");re.remoteStats(ee);break;default:throw new Error('unknown notification method "'+ie+'"')}}).catch(function(e){v.error("receiveNotification() failed [notification:%o]: %s",ne,e)})}},{key:"_sendRequest",value:function(i,e){var a=this,s=Object.assign({method:i,target:"peer"},e);return this.closed?(v.error("_sendRequest() | Room closed [method:%s, request:%o]",i,s),Promise.reject(new c.InvalidStateError("Room closed"))):(v.debug("_sendRequest() [method:%s, request:%o]",i,s),new Promise(function(t,r){var n=!1,o=setTimeout(function(){v.error("request failed [method:%s]: timeout",i),n=!0,r(new c.TimeoutError("timeout"))},a._settings.requestTimeout);a.safeEmit("request",s,function(e){if(!n){if(n=!0,clearTimeout(o),a.closed)return v.error("request failed [method:%s]: Room closed",i),void r(new Error("Room closed"));v.debug("request succeeded [method:%s, response:%o]",i,e),t(e)}},function(e){if(!n){if(n=!0,clearTimeout(o),a.closed)return v.error("request failed [method:%s]: Room closed",i),void r(new Error("Room closed"));e instanceof Error||(e=new Error(String(e))),v.error("request failed [method:%s]:%o",i,e),r(e)}})}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);v.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,i=new f.default(r,o);this._peers.set(i.name,i),i.on("@close",function(){t._peers.delete(i.name)});var a=!0,s=!1,c=void 0;try{for(var u,d=n[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;try{this._handleConsumerData(l,i)}catch(e){v.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",i)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,i=e.paused,a=e.appData,s=new p.default(r,n,o,t,a);u.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),i&&s.remotePause(),t.addConsumer(s)}},{key:"joined",get:function(){return this._state===y.joined}},{key:"closed",get:function(){return this._state===y.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}]),r}();r.default=h},{"./Consumer":113,"./Device":114,"./EnhancedEventEmitter":115,"./Logger":116,"./Peer":117,"./Producer":118,"./Transport":120,"./errors":121,"./ortc":133}],120:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=i(e("./Logger")),a=i(e("./EnhancedEventEmitter")),s=e("./errors"),c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils")),u=i(e("./Device")),d=i(e("./CommandQueue"));function i(e){return e&&e.__esModule?e:{default:e}}var l=new o.default("Transport"),f=function(e){function i(e,t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,l));return l.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t),o._id=c.randomNumber(),o._closed=!1,o._direction=e,o._settings=r,o._appData=n,o._statsEnabled=!1,o._commandQueue=new d.default,o._handler=new u.default.Handler(e,t,r),o._connectionState="new",o._commandQueue.on("exec",o._execCommand.bind(o)),o._handleHandler(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.default),n(i,[{key:"close",value:function(e){l.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e){l.debug("remoteClose()"),this._closed||(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var r=this;l.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var e={id:r._id};return r.safeEmitAsPromise("@request","restartTransport",e)}).then(function(e){var t=e.iceParameters;return r._commandQueue.push("restartIce",{remoteIceParameters:t})}).catch(function(e){l.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;l.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){l.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var o=this,e=this._handler;e.on("@connectionstatechange",function(e){o._connectionState!==e&&(l.debug("Transport connection state changed to %s",e),o._connectionState=e,o._closed||o.safeEmit("connectionstatechange",e))}),e.on("@needcreatetransport",function(e,t,r){var n={id:o._id,direction:o._direction,options:o._settings.transportOptions,appData:o._appData};e&&(n.dtlsParameters=e.dtlsParameters),o.safeEmit("@request","createTransport",n,t,r)}),e.on("@needupdatetransport",function(e){var t={id:o._id,dtlsParameters:e.dtlsParameters};o.safeEmit("@notify","updateTransport",t)}),e.on("@needupdateproducer",function(e,t){var r={id:e.id,rtpParameters:t};e.setRtpParameters(t),o.safeEmit("@notify","updateProducer",r)})}},{key:"addProducer",value:function(e){return l.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){l.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){l.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){l.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return l.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){l.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){l.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return l.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new s.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){l.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){l.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){l.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){l.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){l.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){l.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r=void 0;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var i=e.producer,a=e.track;r=this._execReplaceProducerTrack(i,a);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'+e.method+'"'))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(r){var n=this;l.debug("_execAddProducer()");var o=void 0;return Promise.resolve().then(function(){return n._handler.addProducer(r)}).then(function(e){o=e;var t={id:r.id,kind:r.kind,transportId:n._id,rtpParameters:e,paused:r.locallyPaused,appData:r.appData};return n.safeEmitAsPromise("@request","createProducer",t)}).then(function(){r.setRtpParameters(o)})}},{key:"_execRemoveProducer",value:function(e){return l.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return l.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(o){var r=this;l.debug("_execAddConsumer()");var i=void 0;return Promise.resolve().then(function(){return r._handler.addConsumer(o)}).then(function(e){i=e;var t={id:o.id,transportId:r.id,paused:o.locallyPaused,preferredProfile:o.preferredProfile};return r.safeEmitAsPromise("@request","enableConsumer",t)}).then(function(e){var t=e.paused,r=e.preferredProfile,n=e.effectiveProfile;return t&&o.remotePause(),r&&o.remoteSetPreferredProfile(r),n&&o.remoteEffectiveProfileChanged(n),i})}},{key:"_execRemoveConsumer",value:function(e){return l.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return l.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}}]),i}();r.default=f},{"./CommandQueue":112,"./Device":114,"./EnhancedEventEmitter":115,"./Logger":116,"./errors":121,"./utils":134}],121:[function(e,t,r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});r.InvalidStateError=function(e){function r(e){o(this,r);var t=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return Object.defineProperty(t,"name",{enumerable:!1,writable:!1,value:"InvalidStateError"}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(t,r):Object.defineProperty(t,"stack",{enumerable:!1,writable:!1,value:new Error(e).stack}),t}return a(r,Error),r}(),r.TimeoutError=function(e){function r(e){o(this,r);var t=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return Object.defineProperty(t,"name",{enumerable:!1,writable:!1,value:"TimeoutError"}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(t,r):Object.defineProperty(t,"stack",{enumerable:!1,writable:!1,value:new Error(e).stack}),t}return a(r,Error),r}(),r.UnsupportedError=function(e){function n(e,t){o(this,n);var r=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return Object.defineProperty(r,"name",{enumerable:!1,writable:!1,value:"UnsupportedError"}),Object.defineProperty(r,"data",{enumerable:!0,writable:!1,value:t}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,n):Object.defineProperty(r,"stack",{enumerable:!1,writable:!1,value:new Error(e).stack}),r}return a(n,Error),n}()},{}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=p(e("sdp-transform")),n=p(e("../Logger")),s=p(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/planBUtils")),f=p(e("./sdp/RemotePlanBSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Chrome55"),g=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new f.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),i(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),_=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r}return v(n,g),i(n,[{key:"addProducer",value:function(r){var n=this,o=r.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",r.id,r.kind,o.id),this._stream.getTrackById(o.id))return Promise.reject("track already added");var t=void 0;return Promise.resolve().then(function(){return n._stream.addTrack(o),n._pc.addStream(n._stream),n._pc.createOffer()}).then(function(e){if(r.simulcast){y.debug("addProducer() | enabling simulcast");var t=a.default.parse(e.sdp);l.addSimulcastForTrack(t,o),t=n._addAudioNackForSdp(t),e={type:"offer",sdp:a.default.write(t)}}return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),n._pc.setLocalDescription(e)}).then(function(){if(!n._transportReady)return n._setupTransport()}).then(function(){t=a.default.parse(n._pc.localDescription.sdp);var e={type:"answer",sdp:n._remoteSdp.createAnswerSdp(t)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),n._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(n._rtpParametersByKind[r.kind]);return l.fillRtpParametersForTrack(e,t,o),e}).catch(function(e){throw n._stream.removeTrack(o),n._pc.addStream(n._stream),e})}},{key:"_addAudioNackForSdp",value:function(e){var t=!0,r=!1,n=void 0;try{for(var o,i=e.media[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if("audio"===a.type){var s={payload:a.rtcpFb[0].payload,type:"nack"};a.rtcpFb.push(s)}}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}return e}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){return r._stream.removeTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).catch(function(e){if(0!==r._stream.getTracks().length)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==r._pc.signalingState){var e=a.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)}})}},{key:"replaceProducerTrack",value:function(r,n){var o=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",r.id,r.kind,n.id);var t=r.track,i=void 0;return Promise.resolve().then(function(){return o._stream.removeTrack(t),o._stream.addTrack(n),o._pc.addStream(o._stream),o._pc.createOffer()}).then(function(e){if(r.simulcast){y.debug("addProducer() | enabling simulcast");var t=a.default.parse(e.sdp);l.addSimulcastForTrack(t,n),e={type:"offer",sdp:a.default.write(t)}}return y.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){i=a.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(i)};return y.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(o._rtpParametersByKind[r.kind]);l.fillRtpParametersForTrack(e,i,n),o.safeEmit("@needupdateproducer",r,e)}).catch(function(e){throw o._stream.removeTrack(n),o._stream.addTrack(t),o._pc.addStream(o._stream),e})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=a.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=a.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));return r._transportCreated=!1,r._transportUpdated=!1,r._kinds=new Set,r._consumerInfos=new Map,r}return v(n,g),i(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject("Consumer already added");var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams()[0].getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject("Consumer not found")}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=a.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new _(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return i(o,null,[{key:"getNativeRtpCapabilities",value:function(){var r=this;y.debug("getNativeRtpCapabilities()");var n=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{n.close()}catch(e){}var t=a.default.parse(e.sdp);return t=r._addAudioNackForSdp(t),d.extractRtpCapabilities(t)}).catch(function(e){try{n.close()}catch(e){}throw e})}},{key:"_addAudioNackForSdp",value:function(e){var t=!0,r=!1,n=void 0;try{for(var o,i=e.media[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if("audio"===a.type){var s={payload:a.rtcpFb[0].payload,type:"nack"};a.rtcpFb.push(s)}}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}return e}},{key:"deviceName",get:function(){return"Chrome55"}}]),o}();r.default=w},{"../EnhancedEventEmitter":115,"../Logger":116,"../ortc":133,"../utils":134,"./sdp/RemotePlanBSdp":127,"./sdp/commonUtils":129,"./sdp/planBUtils":130,"sdp-transform":150}],123:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),o=d(e("../Logger")),i=d(e("../EnhancedEventEmitter")),s=u(e("../utils")),a=u(e("../ortc")),c=u(e("./ortc/edgeUtils"));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}var l="CNAME-EDGE-"+s.randomNumber(),f=new o.default("Edge11"),p=function(e){function o(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,f));return f.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t),n._rtpParametersByKind={audio:a.getSendingRtpParameters("audio",t),video:a.getSendingRtpParameters("video",t)},n._transportReady=!1,n._iceGatherer=null,n._iceTransport=null,n._dtlsTransport=null,n._rtpSenders=new Map,n._rtpReceivers=new Map,n._transportRemoteParameters=null,n._setIceGatherer(r),n._setIceTransport(),n._setDtlsTransport(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,i.default),n(o,null,[{key:"getNativeRtpCapabilities",value:function(){return f.debug("getNativeRtpCapabilities()"),c.getCapabilities()}},{key:"deviceName",get:function(){return"Edge11"}}]),n(o,[{key:"close",value:function(){f.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;try{i.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}var a=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw c}}}},{key:"addProducer",value:function(o){var i=this,a=o.track;return f.debug("addProducer() [id:%s, kind:%s, trackId:%s]",o.id,o.kind,a.id),this._rtpSenders.has(o.id)?Promise.reject("Producer already added"):Promise.resolve().then(function(){if(!i._transportReady)return i._setupTransport()}).then(function(){f.debug("addProducer() | calling new RTCRtpSender()");var e=new RTCRtpSender(a,i._dtlsTransport),t=s.clone(i._rtpParametersByKind[o.kind]),r={ssrc:s.randomNumber()};t.codecs.some(function(e){return"rtx"===e.name})&&(r.rtx={ssrc:s.randomNumber()}),t.encodings.push(r),t.rtcp={cname:l,reducedSize:!0,mux:!0};var n=c.mangleRtpParameters(t);return f.debug("addProducer() | calling rtpSender.send() [params:%o]",n),e.send(n),i._rtpSenders.set(o.id,e),t})}},{key:"removeProducer",value:function(t){var r=this,e=t.track;return f.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,e.id),Promise.resolve().then(function(){var e=r._rtpSenders.get(t.id);if(!e)throw new Error("RTCRtpSender not found");r._rtpSenders.delete(t.id);try{f.debug("removeProducer() | calling rtpSender.stop()"),e.stop()}catch(e){f.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(t,r){var n=this;return f.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,r.id),Promise.resolve().then(function(){var e=n._rtpSenders.get(t.id);if(!e)throw new Error("RTCRtpSender not found");e.setTrack(r)})}},{key:"addConsumer",value:function(r){var n=this;return f.debug("addConsumer() [id:%s, kind:%s]",r.id,r.kind),this._rtpReceivers.has(r.id)?Promise.reject("Consumer already added"):Promise.resolve().then(function(){f.debug("addProducer() | calling new RTCRtpReceiver()");var e=new RTCRtpReceiver(n._dtlsTransport,r.kind);e.addEventListener("error",function(e){f.error('iceGatherer "error" event [event:%o]',e)});var t=c.mangleRtpParameters(r.rtpParameters);f.debug("addProducer() | calling rtpReceiver.receive() [params:%o]",t),e.receive(t),n._rtpReceivers.set(r.id,e)})}},{key:"removeConsumer",value:function(t){var r=this;return f.debug("removeConsumer() [id:%s, kind:%s]",t.id,t.kind),Promise.resolve().then(function(){var e=r._rtpReceivers.get(t.id);if(!e)throw new Error("RTCRtpReceiver not found");r._rtpReceivers.delete(t.id);try{f.debug("removeConsumer() | calling rtpReceiver.stop()"),e.stop()}catch(e){f.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(s){var c=this;f.debug("restartIce()"),Promise.resolve().then(function(){c._transportRemoteParameters.iceParameters=s;var e=c._transportRemoteParameters.iceCandidates;f.debug("restartIce() | calling iceTransport.start()"),c._iceTransport.start(c._iceGatherer,s,"controlling");var t=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;c._iceTransport.addRemoteCandidate(a)}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}c._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:"all"});t.addEventListener("error",function(e){f.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){f.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){f.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",function(){f.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",function(){f.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state)}),e.addEventListener("error",function(e){f.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}},{key:"_setupTransport",value:function(){var d=this;return f.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=d._dtlsTransport.getLocalParameters();return t.role="server",e.dtlsParameters=t,d.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){var t=(d._transportRemoteParameters=e).iceParameters,r=e.iceCandidates,n=e.dtlsParameters;d._iceTransport.start(d._iceGatherer,t,"controlling");var o=!0,i=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;d._iceTransport.addRemoteCandidate(u)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}d._iceTransport.addRemoteCandidate({}),n.fingerprints=n.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),d._dtlsTransport.start(n),d._transportReady=!0})}}]),o}();r.default=p},{"../EnhancedEventEmitter":115,"../Logger":116,"../ortc":133,"../utils":134,"./ortc/edgeUtils":126}],124:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=p(e("sdp-transform")),n=p(e("../Logger")),s=p(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/unifiedPlanUtils")),f=p(e("./sdp/RemoteUnifiedPlanSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Firefox50"),g=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new f.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),i(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),_=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r._nextRid=1,r}return v(n,g),i(n,[{key:"addProducer",value:function(t){var r=this,n=t.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,n.id),this._stream.getTrackById(n.id))return Promise.reject("track already added");var o=void 0,i=void 0;return Promise.resolve().then(function(){r._stream.addTrack(n),o=r._pc.addTrack(n,r._stream)}).then(function(){if(t.simulcast){y.debug("addProducer() | enabling simulcast");var e=[];return t.simulcast.high&&e.push({rid:"high"+r._nextRid,active:!0,priority:"high",maxBitrate:t.simulcast.high}),t.simulcast.medium&&e.push({rid:"medium"+r._nextRid,active:!0,priority:"medium",maxBitrate:t.simulcast.medium}),t.simulcast.low&&e.push({rid:"low"+r._nextRid,active:!0,priority:"low",maxBitrate:t.simulcast.low}),r._nextRid++,o.setParameters({encodings:e})}}).then(function(){return r._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){i=a.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(i)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(r._rtpParametersByKind[t.kind]);return l.fillRtpParametersForTrack(e,i,n),e}).catch(function(e){try{r._pc.removeTrack(o)}catch(e){}throw r._stream.removeTrack(n),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===t});if(!e)throw new Error("RTCRtpSender found");return r._pc.removeTrack(e),r._stream.removeTrack(t),Promise.resolve().then(function(){return r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)})}).then(function(){var e=a.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=a.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=a.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));r._transportCreated=!1,r._transportUpdated=!1,r._consumerInfos=new Map;return r._consumerInfos.set(555,{mid:"fake-datachannel-consumer",kind:"application",closed:!1,cname:null}),r}return v(n,g),i(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject("Consumer already added");var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"consumer-"+e.kind+"-"+e.id,kind:e.kind,closed:e.closed,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject("Consumer not found")}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=a.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new _(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return i(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n=document.createElement("canvas");n.getContext("2d");var e=n.captureStream(),t=e.getVideoTracks()[0];return r.addTrack(t,e).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){try{n.remove()}catch(e){}try{r.close()}catch(e){}var t=a.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{n.remove()}catch(e){}try{r.close()}catch(e){}throw e})}},{key:"deviceName",get:function(){return"Firefox50"}}]),o}();r.default=w},{"../EnhancedEventEmitter":115,"../Logger":116,"../ortc":133,"../utils":134,"./sdp/RemoteUnifiedPlanSdp":128,"./sdp/commonUtils":129,"./sdp/unifiedPlanUtils":131,"sdp-transform":150}],125:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),a=p(e("sdp-transform")),n=p(e("../Logger")),s=p(e("../EnhancedEventEmitter")),c=o(e("../utils")),u=o(e("../ortc")),d=o(e("./sdp/commonUtils")),l=o(e("./sdp/planBUtils")),f=p(e("./sdp/RemotePlanBSdp"));function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=new n.default("Safari11"),g=function(e){function o(e,t,r){m(this,o);var n=h(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,y));return n._pc=new RTCPeerConnection({iceServers:r.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),n._rtpParametersByKind=t,n._remoteSdp=new f.default(e,t),n._pc.addEventListener("iceconnectionstatechange",function(){switch(n._pc.iceConnectionState){case"checking":n.emit("@connectionstatechange","connecting");break;case"connected":case"completed":n.emit("@connectionstatechange","connected");break;case"failed":n.emit("@connectionstatechange","failed");break;case"disconnected":n.emit("@connectionstatechange","disconnected");break;case"closed":n.emit("@connectionstatechange","closed")}}),n}return v(o,s.default),i(o,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),o}(),_=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"send",e,t));return r._transportReady=!1,r._stream=new MediaStream,r}return v(n,g),i(n,[{key:"addProducer",value:function(t){var r=this,n=t.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",t.id,t.kind,n.id),this._stream.getTrackById(n.id))return Promise.reject("track already added");var o=void 0,i=void 0;return Promise.resolve().then(function(){return r._stream.addTrack(n),o=r._pc.addTrack(n,r._stream),r._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){i=a.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(i)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var e=c.clone(r._rtpParametersByKind[t.kind]);return l.fillRtpParametersForTrack(e,i,n),e}).catch(function(e){try{r._pc.removeTrack(o)}catch(e){}throw r._stream.removeTrack(n),e})}},{key:"removeProducer",value:function(e){var r=this,t=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===t});if(!e)throw new Error("RTCRtpSender found");return r._pc.removeTrack(e),r._stream.removeTrack(t),r._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).catch(function(e){if(0!==r._stream.getTracks().length)throw e;y.warn("removeLocalTrack() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==r._pc.signalingState){var e=a.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var r=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return r._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),r._pc.setLocalDescription(e)}).then(function(){var e=a.default.parse(r._pc.localDescription.sdp),t={type:"answer",sdp:r._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),r._pc.setRemoteDescription(t)})}},{key:"_setupTransport",value:function(){var o=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var e={},t=o._pc.localDescription.sdp,r=a.default.parse(t),n=d.extractDtlsParameters(r);return n.role="server",e.dtlsParameters=n,o._remoteSdp.setTransportLocalParameters(e),o.safeEmitAsPromise("@needcreatetransport",e)}).then(function(e){o._remoteSdp.setTransportRemoteParameters(e),o._transportReady=!0})}}]),n}(),b=function(e){function n(e,t){m(this,n);var r=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"recv",e,t));return r._transportCreated=!1,r._transportUpdated=!1,r._kinds=new Set,r._consumerInfos=new Map,r}return v(n,g),i(n,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject("Consumer already added");var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject("Consumer not found")}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var t=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return t.safeEmitAsPromise("@needcreatetransport",null)}).then(function(e){t._remoteSdp.setTransportRemoteParameters(e),t._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=a.default.parse(e),r={dtlsParameters:d.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),n}(),w=function(){function o(e,t,r){m(this,o),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,t);var n=void 0;switch(e){case"send":return n={audio:u.getSendingRtpParameters("audio",t),video:u.getSendingRtpParameters("video",t)},new _(n,r);case"recv":return n={audio:u.getReceivingFullRtpParameters("audio",t),video:u.getReceivingFullRtpParameters("video",t)},new b(n,r)}}return i(o,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return r.addTransceiver("audio"),r.addTransceiver("video"),r.createOffer().then(function(e){try{r.close()}catch(e){}var t=a.default.parse(e.sdp);return d.extractRtpCapabilities(t)}).catch(function(e){try{r.close()}catch(e){}throw e})}},{key:"deviceName",get:function(){return"Safari11"}}]),o}();r.default=w},{"../EnhancedEventEmitter":115,"../Logger":116,"../ortc":133,"../utils":134,"./sdp/RemotePlanBSdp":127,"./sdp/commonUtils":129,"./sdp/planBUtils":130,"sdp-transform":150}],126:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=m.clone(e),r=!0,n=!1,o=void 0;try{for(var i,a=t.codecs[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;s.channels=s.numChannels,delete s.numChannels,"audio"!==s.kind?delete s.channels:s.channels||(s.channels=1),s.mimeType=s.kind+"/"+s.name,"rtx"===s.name&&(s.parameters.apt=Number(s.parameters.apt));var c=!0,u=!1,d=void 0;try{for(var l,f=(s.rtcpFeedback||[])[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var p=l.value;p.parameter||delete p.parameter}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return t},r.mangleRtpParameters=function(e){var t=m.clone(e),r=!0,n=!1,o=void 0;try{for(var i,a=t.codecs[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;s.channels&&(s.numChannels=s.channels,delete s.channels),delete s.mimeType}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return t};var m=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"))},{"../../utils":134}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),$=a(e("sdp-transform")),o=a(e("../../Logger")),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var X=new o.default("RemotePlanBSdp"),d=function(){function t(e){u(this,t),this._rtpParametersByKind=e,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return n(t,[{key:"setTransportLocalParameters",value:function(e){X.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){X.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){X.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),t}(),l=function(e){function t(e){return u(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,d),n(t,[{key:"createAnswerSdp",value:function(e){if(X.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},i=(e.media||[]).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},o.groups=[{type:"BUNDLE",mids:i.join(" ")}],o.media=[];var a=n.fingerprints.length,s=!0,c=!(o.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value}),u=void 0;try{for(var d,l=(e.media||[])[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var f=d.value,p=f.type,m=this._rtpParametersByKind[p].codecs,h=this._rtpParametersByKind[p].headerExtensions,v={};v.type=f.type,v.port=7,v.protocol="RTP/SAVPF",v.connection={ip:"127.0.0.1",version:4},v.mid=f.mid,v.iceUfrag=t.usernameFragment,v.icePwd=t.password,v.candidates=[];var y=!0,g=!1,_=void 0;try{for(var b,w=r[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var k=b.value,P={component:1};P.foundation=k.foundation,P.ip=k.ip,P.port=k.port,P.priority=k.priority,P.transport=k.protocol,P.type=k.type,k.tcpType&&(P.tcptype=k.tcpType),v.candidates.push(P)}}catch(e){g=!0,_=e}finally{try{!y&&w.return&&w.return()}finally{if(g)throw _}}switch(v.endOfCandidates="end-of-candidates",v.iceOptions="renomination",n.role){case"client":v.setup="active";break;case"server":v.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":v.direction="recvonly";break;case"recvonly":case"inactive":v.direction="inactive"}"video"===p&&(v.xGoogleFlag="conference"),v.rtp=[],v.rtcpFb=[],v.fmtp=[];var S=!0,T=!1,R=void 0;try{for(var C,x=m[Symbol.iterator]();!(S=(C=x.next()).done);S=!0){var E=C.value,j={payload:E.payloadType,codec:E.name,rate:E.clockRate};if(1<E.channels&&(j.encoding=E.channels),v.rtp.push(j),E.parameters){var O={payload:E.payloadType,config:""},M=!0,L=!1,I=void 0;try{for(var D,A=Object.keys(E.parameters)[Symbol.iterator]();!(M=(D=A.next()).done);M=!0){var F=D.value;O.config&&(O.config+=";"),O.config+=F+"="+E.parameters[F]}}catch(e){L=!0,I=e}finally{try{!M&&A.return&&A.return()}finally{if(L)throw I}}O.config&&v.fmtp.push(O)}if(E.rtcpFeedback){var N=!0,B=!1,U=void 0;try{for(var V,z=E.rtcpFeedback[Symbol.iterator]();!(N=(V=z.next()).done);N=!0){var W=V.value;v.rtcpFb.push({payload:E.payloadType,type:W.type,subtype:W.parameter||""})}}catch(e){B=!0,U=e}finally{try{!N&&z.return&&z.return()}finally{if(B)throw U}}}}}catch(e){T=!0,R=e}finally{try{!S&&x.return&&x.return()}finally{if(T)throw R}}v.payloads=m.map(function(e){return e.payloadType}).join(" "),v.ext=[];var q=function(t){if(!(f.ext||[]).find(function(e){return e.uri===t.uri}))return"continue";v.ext.push({uri:t.uri,value:t.id})},G=!0,K=!1,H=void 0;try{for(var J,Q=h[Symbol.iterator]();!(G=(J=Q.next()).done);G=!0)q(J.value)}catch(e){K=!0,H=e}finally{try{!G&&Q.return&&Q.return()}finally{if(K)throw H}}v.rtcpMux="rtcp-mux",v.rtcpRsize="rtcp-rsize",o.media.push(v)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return $.default.write(o)}}]),t}(),f=function(e){function r(e){u(this,r);var t=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t._streamId="recv-stream-"+i.randomNumber(),t}return c(r,d),n(r,[{key:"createOfferSdp",value:function(e,W){var q=this;if(X.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var G=this._transportRemoteParameters.iceParameters,K=this._transportRemoteParameters.iceCandidates,t=this._transportRemoteParameters.dtlsParameters,H={},r=e;this._sdpGlobalFields.version++,H.version=0,H.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},H.name="-",H.timing={start:0,stop:0},H.icelite=G.iceLite?"ice-lite":null,H.msidSemantic={semantic:"WMS",token:"*"},H.groups=[{type:"BUNDLE",mids:r.join(" ")}],H.media=[];var n=t.fingerprints.length,o=function(t){var e=q._rtpParametersByKind[t].codecs,r=q._rtpParametersByKind[t].headerExtensions,n={};n.type=t,n.port=7,n.protocol="RTP/SAVPF",n.connection={ip:"127.0.0.1",version:4},n.mid=t,n.iceUfrag=G.usernameFragment,n.icePwd=G.password;var o=!0,i=!(n.candidates=[]),a=void 0;try{for(var s,c=K[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value,d={component:1};d.foundation=u.foundation,d.ip=u.ip,d.port=u.port,d.priority=u.priority,d.transport=u.protocol,d.type=u.type,u.tcpType&&(d.tcptype=u.tcpType),n.candidates.push(d)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}n.endOfCandidates="end-of-candidates",n.iceOptions="renomination",n.setup="actpass",W.some(function(e){return e.kind===t})?n.direction="sendonly":n.direction="inactive",n.rtp=[],n.rtcpFb=[];var l=!0,f=!(n.fmtp=[]),p=void 0;try{for(var m,h=e[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value,y={payload:v.payloadType,codec:v.name,rate:v.clockRate};if(1<v.channels&&(y.encoding=v.channels),n.rtp.push(y),v.parameters){var g={payload:v.payloadType,config:""},_=!0,b=!1,w=void 0;try{for(var k,P=Object.keys(v.parameters)[Symbol.iterator]();!(_=(k=P.next()).done);_=!0){var S=k.value;g.config&&(g.config+=";"),g.config+=S+"="+v.parameters[S]}}catch(e){b=!0,w=e}finally{try{!_&&P.return&&P.return()}finally{if(b)throw w}}g.config&&n.fmtp.push(g)}if(v.rtcpFeedback){var T=!0,R=!1,C=void 0;try{for(var x,E=v.rtcpFeedback[Symbol.iterator]();!(T=(x=E.next()).done);T=!0){var j=x.value;n.rtcpFb.push({payload:v.payloadType,type:j.type,subtype:j.parameter||""})}}catch(e){R=!0,C=e}finally{try{!T&&E.return&&E.return()}finally{if(R)throw C}}}}}catch(e){f=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(f)throw p}}n.payloads=e.map(function(e){return e.payloadType}).join(" ");var O=!0,M=!(n.ext=[]),L=void 0;try{for(var I,D=r[Symbol.iterator]();!(O=(I=D.next()).done);O=!0){var A=I.value;n.ext.push({uri:A.uri,value:A.id})}}catch(e){M=!0,L=e}finally{try{!O&&D.return&&D.return()}finally{if(M)throw L}}n.rtcpMux="rtcp-mux",n.rtcpRsize="rtcp-rsize",n.ssrcs=[];var F=!0,N=!(n.ssrcGroups=[]),B=void 0;try{for(var U,V=W[Symbol.iterator]();!(F=(U=V.next()).done);F=!0){var z=U.value;z.kind===t&&(n.ssrcs.push({id:z.ssrc,attribute:"msid",value:q._streamId+" "+z.trackId}),n.ssrcs.push({id:z.ssrc,attribute:"mslabel",value:q._streamId}),n.ssrcs.push({id:z.ssrc,attribute:"label",value:z.trackId}),n.ssrcs.push({id:z.ssrc,attribute:"cname",value:z.cname}),z.rtxSsrc&&(n.ssrcs.push({id:z.rtxSsrc,attribute:"msid",value:q._streamId+" "+z.trackId}),n.ssrcs.push({id:z.rtxSsrc,attribute:"mslabel",value:q._streamId}),n.ssrcs.push({id:z.rtxSsrc,attribute:"label",value:z.trackId}),n.ssrcs.push({id:z.rtxSsrc,attribute:"cname",value:z.cname}),n.ssrcGroups.push({semantics:"FID",ssrcs:z.ssrc+" "+z.rtxSsrc})))}}catch(e){N=!0,B=e}finally{try{!F&&V.return&&V.return()}finally{if(N)throw B}}H.media.push(n)},i=!0,a=!(H.fingerprint={type:t.fingerprints[n-1].algorithm,hash:t.fingerprints[n-1].value}),s=void 0;try{for(var c,u=e[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){o(c.value)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return $.default.write(H)}}]),r}();r.default=function e(t,r){switch(u(this,e),X.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new l(r);case"recv":return new f(r)}}},{"../../Logger":116,"../../utils":134,"sdp-transform":150}],128:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),ne=a(e("sdp-transform")),o=a(e("../../Logger")),i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../../utils"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var oe=new o.default("RemoteUnifiedPlanSdp"),d=function(){function t(e){u(this,t),this._rtpParametersByKind=e,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:i.randomNumber(),version:0}}return n(t,[{key:"setTransportLocalParameters",value:function(e){oe.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){oe.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){oe.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),t}(),l=function(e){function t(e){return u(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return c(t,d),n(t,[{key:"createAnswerSdp",value:function(e){if(oe.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},i=(e.media||[]).filter(function(e){return e.mid}).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},0<i.length&&(o.groups=[{type:"BUNDLE",mids:i.join(" ")}]),o.media=[];var a=n.fingerprints.length,s=!0,c=!(o.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value}),u=void 0;try{for(var d,l=(e.media||[])[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var f=d.value,p="inactive"===f.direction,m=f.type,h=this._rtpParametersByKind[m].codecs,v=this._rtpParametersByKind[m].headerExtensions,y={};y.type=f.type,y.port=7,y.protocol="RTP/SAVPF",y.connection={ip:"127.0.0.1",version:4},y.mid=f.mid,y.iceUfrag=t.usernameFragment,y.icePwd=t.password,y.candidates=[];var g=!0,_=!1,b=void 0;try{for(var w,k=r[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var P=w.value,S={component:1};S.foundation=P.foundation,S.ip=P.ip,S.port=P.port,S.priority=P.priority,S.transport=P.protocol,S.type=P.type,P.tcpType&&(S.tcptype=P.tcpType),y.candidates.push(S)}}catch(e){_=!0,b=e}finally{try{!g&&k.return&&k.return()}finally{if(_)throw b}}switch(y.endOfCandidates="end-of-candidates",y.iceOptions="renomination",n.role){case"client":y.setup="active";break;case"server":y.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":y.direction="recvonly";break;case"recvonly":case"inactive":y.direction="inactive"}y.rtp=[],y.rtcpFb=[],y.fmtp=[];var T=!0,R=!1,C=void 0;try{for(var x,E=h[Symbol.iterator]();!(T=(x=E.next()).done);T=!0){var j=x.value,O={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(1<j.channels&&(O.encoding=j.channels),y.rtp.push(O),j.parameters){var M={payload:j.payloadType,config:""},L=!0,I=!1,D=void 0;try{for(var A,F=Object.keys(j.parameters)[Symbol.iterator]();!(L=(A=F.next()).done);L=!0){var N=A.value;M.config&&(M.config+=";"),M.config+=N+"="+j.parameters[N]}}catch(e){I=!0,D=e}finally{try{!L&&F.return&&F.return()}finally{if(I)throw D}}M.config&&y.fmtp.push(M)}if(j.rtcpFeedback){var B=!0,U=!1,V=void 0;try{for(var z,W=j.rtcpFeedback[Symbol.iterator]();!(B=(z=W.next()).done);B=!0){var q=z.value;y.rtcpFb.push({payload:j.payloadType,type:q.type,subtype:q.parameter||""})}}catch(e){U=!0,V=e}finally{try{!B&&W.return&&W.return()}finally{if(U)throw V}}}}}catch(e){R=!0,C=e}finally{try{!T&&E.return&&E.return()}finally{if(R)throw C}}if(y.payloads=h.map(function(e){return e.payloadType}).join(" "),!p){y.ext=[];var G=function(t){if(!(f.ext||[]).find(function(e){return e.uri===t.uri}))return"continue";y.ext.push({uri:t.uri,value:t.id})},K=!0,H=!1,J=void 0;try{for(var Q,$=v[Symbol.iterator]();!(K=(Q=$.next()).done);K=!0)G(Q.value)}catch(e){H=!0,J=e}finally{try{!K&&$.return&&$.return()}finally{if(H)throw J}}}if(f.simulcast_03){y.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},y.rids=[];var X=!0,Y=!1,Z=void 0;try{for(var ee,te=(f.rids||[])[Symbol.iterator]();!(X=(ee=te.next()).done);X=!0){var re=ee.value;"send"===re.direction&&y.rids.push({id:re.id,direction:"recv"})}}catch(e){Y=!0,Z=e}finally{try{!X&&te.return&&te.return()}finally{if(Y)throw Z}}}y.rtcpMux="rtcp-mux",y.rtcpRsize="rtcp-rsize",o.media.push(y)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return ne.default.write(o)}}]),t}(),f=function(e){function r(e){u(this,r);var t=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t._streamId="recv-stream-"+i.randomNumber(),t}return c(r,d),n(r,[{key:"createOfferSdp",value:function(e){if(oe.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},i=e.filter(function(e){return!e.closed}).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},0<i.length&&(o.groups=[{type:"BUNDLE",mids:i.join(" ")}]),o.media=[];var a=n.fingerprints.length,s=!0,c=!(o.fingerprint={type:n.fingerprints[a-1].algorithm,hash:n.fingerprints[a-1].value}),u=void 0;try{for(var d,l=e[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var f=d.value,p=f.closed,m=f.kind,h=void 0,v=void 0;"application"!==f.kind&&(h=this._rtpParametersByKind[m].codecs,v=this._rtpParametersByKind[m].headerExtensions);var y={};"application"!==f.kind?(y.type=m,y.port=7,y.protocol="RTP/SAVPF",y.connection={ip:"127.0.0.1",version:4},y.mid=f.mid,y.msid=this._streamId+" "+f.trackId):(y.type=m,y.port=9,y.protocol="DTLS/SCTP",y.connection={ip:"127.0.0.1",version:4},y.mid=f.mid),y.iceUfrag=t.usernameFragment,y.icePwd=t.password,y.candidates=[];var g=!0,_=!1,b=void 0;try{for(var w,k=r[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var P=w.value,S={component:1};S.foundation=P.foundation,S.ip=P.ip,S.port=P.port,S.priority=P.priority,S.transport=P.protocol,S.type=P.type,P.tcpType&&(S.tcptype=P.tcpType),y.candidates.push(S)}}catch(e){_=!0,b=e}finally{try{!g&&k.return&&k.return()}finally{if(_)throw b}}if(y.endOfCandidates="end-of-candidates",y.iceOptions="renomination",y.setup="actpass","application"!==f.kind){y.direction=p?"inactive":"sendonly",y.rtp=[],y.rtcpFb=[],y.fmtp=[];var T=!0,R=!1,C=void 0;try{for(var x,E=h[Symbol.iterator]();!(T=(x=E.next()).done);T=!0){var j=x.value,O={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(1<j.channels&&(O.encoding=j.channels),y.rtp.push(O),j.parameters){var M={payload:j.payloadType,config:""},L=!0,I=!1,D=void 0;try{for(var A,F=Object.keys(j.parameters)[Symbol.iterator]();!(L=(A=F.next()).done);L=!0){var N=A.value;M.config&&(M.config+=";"),M.config+=N+"="+j.parameters[N]}}catch(e){I=!0,D=e}finally{try{!L&&F.return&&F.return()}finally{if(I)throw D}}M.config&&y.fmtp.push(M)}if(j.rtcpFeedback){var B=!0,U=!1,V=void 0;try{for(var z,W=j.rtcpFeedback[Symbol.iterator]();!(B=(z=W.next()).done);B=!0){var q=z.value;y.rtcpFb.push({payload:j.payloadType,type:q.type,subtype:q.parameter||""})}}catch(e){U=!0,V=e}finally{try{!B&&W.return&&W.return()}finally{if(U)throw V}}}}}catch(e){R=!0,C=e}finally{try{!T&&E.return&&E.return()}finally{if(R)throw C}}if(y.payloads=h.map(function(e){return e.payloadType}).join(" "),!p){y.ext=[];var G=!0,K=!1,H=void 0;try{for(var J,Q=v[Symbol.iterator]();!(G=(J=Q.next()).done);G=!0){var $=J.value;y.ext.push({uri:$.uri,value:$.id})}}catch(e){K=!0,H=e}finally{try{!G&&Q.return&&Q.return()}finally{if(K)throw H}}}y.rtcpMux="rtcp-mux",y.rtcpRsize="rtcp-rsize",p||(y.ssrcs=[],y.ssrcGroups=[],y.ssrcs.push({id:f.ssrc,attribute:"cname",value:f.cname}),f.rtxSsrc&&(y.ssrcs.push({id:f.rtxSsrc,attribute:"cname",value:f.cname}),y.ssrcGroups.push({semantics:"FID",ssrcs:f.ssrc+" "+f.rtxSsrc})))}else y.payloads=5e3,y.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(y)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return ne.default.write(o)}}]),r}();r.default=function e(t,r){switch(u(this,e),oe.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new l(r);case"recv":return new f(r)}}},{"../../Logger":116,"../../utils":134,"sdp-transform":150}],129:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,o=!1,i=!0,a=!1,s=void 0;try{for(var c,u=e.media[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var d=c.value,l=d.type;switch(l){case"audio":if(n)continue;n=!0;break;case"video":if(o)continue;o=!0;break;default:continue}var f=!0,p=!1,m=void 0;try{for(var h,v=d.rtp[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var y=h.value,g={name:y.codec,mimeType:l+"/"+y.codec,kind:l,clockRate:y.rate,preferredPayloadType:y.payload,channels:y.encoding,rtcpFeedback:[],parameters:{}};"audio"!==g.kind?delete g.channels:g.channels||(g.channels=1),t.set(g.preferredPayloadType,g)}}catch(e){p=!0,m=e}finally{try{!f&&v.return&&v.return()}finally{if(p)throw m}}var _=!0,b=!1,w=void 0;try{for(var k,P=(d.fmtp||[])[Symbol.iterator]();!(_=(k=P.next()).done);_=!0){var S=k.value,T=U.default.parseFmtpConfig(S.config),g=t.get(S.payload);g&&(g.parameters=T)}}catch(e){b=!0,w=e}finally{try{!_&&P.return&&P.return()}finally{if(b)throw w}}var R=!0,C=!1,x=void 0;try{for(var E,j=(d.rtcpFb||[])[Symbol.iterator]();!(R=(E=j.next()).done);R=!0){var O=E.value,g=t.get(O.payload);if(g){var M={type:O.type,parameter:O.subtype};M.parameter||delete M.parameter,g.rtcpFeedback.push(M)}}}catch(e){C=!0,x=e}finally{try{!R&&j.return&&j.return()}finally{if(C)throw x}}var L=!0,I=!1,D=void 0;try{for(var A,F=(d.ext||[])[Symbol.iterator]();!(L=(A=F.next()).done);L=!0){var N=A.value,B={kind:l,uri:N.uri,preferredId:N.value};r.push(B)}}catch(e){I=!0,D=e}finally{try{!L&&F.return&&F.return()}finally{if(I)throw D}}}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},r.extractDtlsParameters=function(e){var t=(o=e,(o.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})),r=t.fingerprint||e.fingerprint,n=void 0;var o;switch(t.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}};var n,o=e("sdp-transform"),U=(n=o)&&n.__esModule?n:{default:n}},{"sdp-transform":150}],130:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var q=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.fillRtpParametersForTrack=function(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find(function(e){return e.type===n});if(!i)throw new Error("m="+n+" section not found");var a=void 0,s=new Set,c=!0,u=!1,d=void 0;try{for(var l,f=(i.ssrcs||[])[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var p=l.value;if("msid"===p.attribute){var m=p.value.split(" ")[1];if(m===r.id){var h=p.id;s.add(h),a||(a=h)}}}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}if(0===s.size)throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");var v=new Map,y=!0,g=!1,_=void 0;try{for(var b,w=(i.ssrcGroups||[])[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var k=b.value;if("FID"===k.semantics){var P=k.ssrcs.split(/\s+/),S=q(P,2),T=S[0],R=S[1];T=Number(T),R=Number(R),s.has(T)&&(s.delete(T),s.delete(R),v.set(T,R))}}}catch(e){g=!0,_=e}finally{try{!y&&w.return&&w.return()}finally{if(g)throw _}}var C=!0,x=!1,E=void 0;try{for(var j,O=s[Symbol.iterator]();!(C=(j=O.next()).done);C=!0){var T=j.value;v.set(T,null)}}catch(e){x=!0,E=e}finally{try{!C&&O.return&&O.return()}finally{if(x)throw E}}var M=i.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===a});M&&(o.cname=M.value);e.rtcp=o,e.encodings=[];var L=1<v.size,I=["low","medium","high"],D=!0,A=!1,F=void 0;try{for(var N,B=v[Symbol.iterator]();!(D=(N=B.next()).done);D=!0){var U=N.value,V=q(U,2),z=V[0],R=V[1],W={ssrc:z};R&&(W.rtx={ssrc:R}),L&&(W.profile=I.shift()),e.encodings.push(W)}}catch(e){A=!0,F=e}finally{try{!D&&B.return&&B.return()}finally{if(A)throw F}}},r.addSimulcastForTrack=function(e,r){var t=r.kind,n=(e.media||[]).find(function(e){return e.type===t});if(!n)throw new Error("m="+t+" section not found");var o=void 0,i=void 0,a=void 0;if(!(n.ssrcs||[]).find(function(e){if("msid"!==e.attribute)return!1;var t=e.value.split(" ")[1];return t===r.id?(o=e.id,a=e.value.split(" ")[0],!0):void 0}))throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");(n.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===o?(i=Number(t[1]),!0):void 0}});var s=n.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});if(!s)throw new Error("CNAME line not found for local track [track.id:"+r.id+"]");var c=s.value,u=o+1,d=o+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:"SIM",ssrcs:o+" "+u+" "+d}),n.ssrcs.push({id:u,attribute:"cname",value:c}),n.ssrcs.push({id:u,attribute:"msid",value:a+" "+r.id}),n.ssrcs.push({id:d,attribute:"cname",value:c}),n.ssrcs.push({id:d,attribute:"msid",value:a+" "+r.id}),i){var l=i+1,f=i+2;n.ssrcGroups.push({semantics:"FID",ssrcs:u+" "+l}),n.ssrcs.push({id:l,attribute:"cname",value:c}),n.ssrcs.push({id:l,attribute:"msid",value:a+" "+r.id}),n.ssrcGroups.push({semantics:"FID",ssrcs:d+" "+f}),n.ssrcs.push({id:f,attribute:"cname",value:c}),n.ssrcs.push({id:f,attribute:"msid",value:a+" "+r.id})}}},{}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,n){var o=n.kind,r={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find(function(e){if(e.type===o){var t=e.msid;if(t){var r=t.split(" ")[1];return r===n.id||void 0}}});if(!i)throw new Error("m="+o+" section not found");var a=(i.ssrcs||[]).find(function(e){return"cname"===e.attribute}),s=void 0;a&&(s=a.id,r.cname=a.value);var c=[],u=!0,d=!1,l=void 0;try{for(var f,p=(i.rids||[])[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var m=f.value;"send"===m.direction&&(/^low/.test(m.id)?c.push({rid:m.id,profile:"low"}):/^medium/.test(m.id)&&c.push({rid:m.id,profile:"medium"}),/^high/.test(m.id)&&c.push({rid:m.id,profile:"high"}))}}catch(e){d=!0,l=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw l}}if(e.rtcp=r,e.encodings=[],0===c.length){var h={ssrc:s};e.encodings.push(h)}else{var v=!0,y=!1,g=void 0;try{for(var _,b=c[Symbol.iterator]();!(v=(_=b.next()).done);v=!0){var w=_.value,k={encodingId:w.rid,profile:w.profile};e.encodings.push(k)}}catch(e){y=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw g}}}}},{}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0,r.isDeviceSupported=function(){return o.default.isSupported()},r.getDeviceInfo=function(){return{flag:o.default.flag,name:o.default.name,version:o.default.version,bowser:o.default.bowser}},r.checkCapabilitiesForRoom=function(r){return o.default.isSupported()?o.default.Handler.getNativeRtpCapabilities().then(function(e){var t=n.getExtendedRtpCapabilities(e,r);return{audio:n.canSend("audio",t),video:n.canSend("video",t)}}):Promise.reject(new Error("current browser/device not supported"))};var n=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./ortc")),o=a(e("./Device")),i=a(e("./Room"));function a(e){return e&&e.__esModule?e:{default:e}}r.Room=i.default},{"./Device":114,"./Room":119,"./ortc":133}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=function(o,n){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},e=function(t){if("rtx"===t.name)return"continue";var e=(o.codecs||[]).find(function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var o=(e.parameters||{})["packetization-mode"]||0,i=(t.parameters||{})["packetization-mode"]||0;if(o!==i)return!1}return!0}(e,t)});if(e){var r={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:e.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:function(e,r){var n=[],t=function(t){var e=(r.rtcpFeedback||[]).find(function(e){return e.type===t.type&&e.parameter===t.parameter});e&&n.push(e)},o=!0,i=!1,a=void 0;try{for(var s,c=(e.rtcpFeedback||[])[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;t(u)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}return n}(e,t),parameters:t.parameters};r.channels||delete r.channels,i.codecs.push(r)}},t=!0,r=!1,a=void 0;try{for(var s,c=(n.codecs||[])[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var u=s.value;e(u)}}catch(e){r=!0,a=e}finally{try{!t&&c.return&&c.return()}finally{if(r)throw a}}var d=function(t){var e=(o.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===t.sendPayloadType}),r=(n.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===t.recvPayloadType});e&&r&&(t.sendRtxPayloadType=e.preferredPayloadType,t.recvRtxPayloadType=r.preferredPayloadType)},l=!0,f=!1,p=void 0;try{for(var m,h=(i.codecs||[])[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;d(v)}}catch(e){f=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(f)throw p}}var y=function(n){var e=(o.headerExtensions||[]).find(function(e){return r=n,!((t=e).kind&&r.kind&&t.kind!==r.kind||t.uri!==r.uri);var t,r});if(e){var t={kind:n.kind,uri:n.uri,sendId:e.preferredId,recvId:n.preferredId};i.headerExtensions.push(t)}},g=!0,_=!1,b=void 0;try{for(var w,k=(n.headerExtensions||[])[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var P=w.value;y(P)}}catch(e){_=!0,b=e}finally{try{!g&&k.return&&k.return()}finally{if(_)throw b}}return i},r.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var i,a=e.codecs[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:s.kind+"/rtx",kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}var d=!0,l=!1,f=void 0;try{for(var p,m=e.headerExtensions[Symbol.iterator]();!(d=(p=m.next()).done);d=!0){var h=p.value,v={kind:h.kind,uri:h.uri,preferredId:h.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,f=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw f}}return t.fecMechanisms=e.fecMechanisms,t},r.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,i=r.codecs,a=function(t){if(!i.some(function(e){return e.recvPayloadType===t})){var e=o.find(function(e){return e.preferredPayloadType===t});if(!e)throw new Error("mandatory codec PT "+t+" not found in remote codecs");n.push(e)}},s=!0,c=!1,u=void 0;try{for(var d,l=t[Symbol.iterator]();!(s=(d=l.next()).done);s=!0){var f=d.value;a(f)}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}return n},r.canSend=function(t,e){return e.codecs.some(function(e){return e.kind===t})},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})},r.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}var l=!0,f=!1,p=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){f=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(f)throw p}}return r},r.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var a,s=t.codecs[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}var l=!0,f=!1,p=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){f=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(f)throw p}}return r}},{}],134:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=function(){return i()},r.clone=function(e){return JSON.parse(JSON.stringify(e))};var n,o=e("random-number");var i=((n=o)&&n.__esModule?n:{default:n}).default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":144}],135:[function(e,t,r){var o=1e3,i=60*o,a=60*i,s=24*a,c=365.25*s;function u(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){t=t||{};var r,n=typeof e;if("string"===n&&0<e.length)return function(e){if(100<(e=String(e)).length)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*c;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?u(r=e,s,"day")||u(r,a,"hour")||u(r,i,"minute")||u(r,o,"second")||r+" ms":function(e){if(s<=e)return Math.round(e/s)+"d";if(a<=e)return Math.round(e/a)+"h";if(i<=e)return Math.round(e/i)+"m";if(o<=e)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],136:[function(e,t,r){var n,o,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,d=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?d=u.concat(d):f=-1,d.length&&m())}function m(){if(!l){var e=c(p);l=!0;for(var t=d.length;t;){for(u=d,d=[];++f<t;)u&&u[f].run();f=-1,t=d.length}u=null,l=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new h(e,t)),1!==d.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],137:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();var i=e("./logger")("Message"),a=e("./utils"),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"parse",value:function(e){var t=void 0,r={};try{t=JSON.parse(e)}catch(e){return void i.error("parse() | invalid JSON: %s",e)}if("object"!==(void 0===t?"undefined":n(t))||Array.isArray(t))i.error("parse() | not an object");else{if("number"==typeof t.id){if(r.id=t.id,t.request){if(r.request=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}else{if(!t.response)return void i.error("parse() | missing request/response field");r.response=!0,t.ok?(r.ok=!0,r.data=t.data||{}):(r.errorCode=t.errorCode,r.errorReason=t.errorReason)}return r}i.error("parse() | missing/invalid id field")}}},{key:"requestFactory",value:function(e,t){return{request:!0,id:a.randomNumber(),method:e,data:t||{}}}},{key:"successResponseFactory",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:"errorResponseFactory",value:function(e,t,r){return{response:!0,id:e.id,errorCode:t,errorReason:r}}}]),e}();t.exports=s},{"./logger":140,"./utils":143}],138:[function(e,t,r){"use strict";var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();var o=e("events").EventEmitter,i=e("./logger")("Peer"),a=e("./Message"),s=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),i.debug("constructor()");var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.setMaxListeners(1/0),t._transport=e,t._closed=!1,t._data={},t._requestHandlers=new Map,t._handleTransport(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,o),n(r,[{key:"send",value:function(e,t){var o=this,i=a.requestFactory(e,t);return this._transport.send(i).then(function(){return new Promise(function(t,r){var n={resolve:function(e){o._requestHandlers.delete(i.id)&&(clearTimeout(n.timer),t(e))},reject:function(e){o._requestHandlers.delete(i.id)&&(clearTimeout(n.timer),r(e))},timer:setTimeout(function(){o._requestHandlers.delete(i.id)&&r(new Error("request timeout"))},2e4),close:function(){clearTimeout(n.timer),r(new Error("peer closed"))}};o._requestHandlers.set(i.id,n)})})}},{key:"close",value:function(){i.debug("close()"),this._closed||(this._closed=!0,this._transport.close(),this._requestHandlers.forEach(function(e){return e.close()}),this.emit("close"))}},{key:"_handleTransport",value:function(){var t=this;if(this._transport.closed)return this._closed=!0,void setTimeout(function(){return t.emit("close")});this._transport.on("connecting",function(e){t.emit("connecting",e)}),this._transport.on("open",function(){t._closed||t.emit("open")}),this._transport.on("disconnected",function(){t.emit("disconnected")}),this._transport.on("failed",function(e){t.emit("failed",e)}),this._transport.on("close",function(){t._closed||(t._closed=!0,t.emit("close"))}),this._transport.on("message",function(e){e.response?t._handleResponse(e):e.request&&t._handleRequest(e)})}},{key:"_handleResponse",value:function(e){var t=this._requestHandlers.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else i.error("received response does not match any sent request")}},{key:"_handleRequest",value:function(n){var o=this;this.emit("request",n,function(e){var t=a.successResponseFactory(n,e);o._transport.send(t).catch(function(e){i.warn("accept() failed, response could not be sent: %o",e)})},function(e,t){e instanceof Error?(t=e.toString(),e=500):"number"==typeof e&&t instanceof Error&&(t=t.toString());var r=a.errorResponseFactory(n,e,t);o._transport.send(r).catch(function(e){i.warn("reject() failed, response could not be sent: %o",e)})})}},{key:"data",get:function(){return this._data},set:function(e){this._data=e||{}}},{key:"closed",get:function(){return this._closed}}]),r}();t.exports=s},{"./Message":137,"./logger":140,events:111}],139:[function(e,t,r){"use strict";var n=e("./Peer"),o=e("./transports");t.exports={Peer:n,WebSocketTransport:o.WebSocketTransport}},{"./Peer":138,"./transports":142}],140:[function(e,t,r){"use strict";var n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();var o=e("debug"),i="protoo-client",a=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e?(this._debug=o(i+":"+e),this._warn=o(i+":WARN:"+e),this._error=o(i+":ERROR:"+e)):(this._debug=o(i),this._warn=o(i+":WARN"),this._error=o(i+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return n(t,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),t}();t.exports=function(e){return new a(e)}},{debug:109}],141:[function(e,t,r){"use strict";var o=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();var i=e("events").EventEmitter,a=e("websocket").w3cwebsocket,s=e("retry"),c=e("../logger")("WebSocketTransport"),u=e("../Message"),d={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},n=function(e){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),c.debug('constructor() [url:"%s", options:%o]',e,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.setMaxListeners(1/0),r._url=e,r._options=t||{},r._ws=null,r._closed=!1,r._setWebSocket(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i),o(n,[{key:"send",value:function(e){if(this._closed)return Promise.reject(new Error("transport closed"));try{return this._ws.send(JSON.stringify(e)),Promise.resolve()}catch(e){return c.error("send() | error sending message: %o",e),Promise.reject(e)}}},{key:"close",value:function(){if(c.debug("close()"),!this._closed){this._closed=!0,this.emit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){c.error("close() | error closing the WebSocket: %o",e)}}}},{key:"_setWebSocket",value:function(){var r=this,e=this._options,n=s.operation(this._options.retry||d),o=!1;n.attempt(function(t){r._closed?n.stop():(c.debug("_setWebSocket() [currentAttempt:%s]",t),r._ws=new a(r._url,"protoo",e.origin,e.headers,e.requestOptions,e.clientConfig),r.emit("connecting",t),r._ws.onopen=function(){r._closed||(o=!0,r.emit("open"))},r._ws.onclose=function(e){if(!r._closed){if(c.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',e.wasClean,e.code,e.reason),4e3!==e.code){if(o)return n.stop(),r.emit("disconnected"),void r._setWebSocket();if(r.emit("failed",t),n.retry(!0))return}r._closed=!0,r.emit("close")}},r._ws.onerror=function(){r._closed||c.error('WebSocket "error" event')},r._ws.onmessage=function(e){if(!r._closed){var t=u.parse(e.data);t&&(0!==r.listenerCount("message")?r.emit("message",t):c.error('no listeners for WebSocket "message" event, ignoring received message'))}})})}},{key:"closed",get:function(){return this._closed}}]),n}();t.exports=n},{"../Message":137,"../logger":140,events:111,retry:146,websocket:153}],142:[function(e,t,r){"use strict";var n=e("./WebSocketTransport");t.exports={WebSocketTransport:n}},{"./WebSocketTransport":141}],143:[function(e,t,r){"use strict";var n=e("random-number").generator({min:1e6,max:9999999,integer:!0});t.exports={randomNumber:n}},{"random-number":144}],144:[function(e,t,r){!function(e){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function o(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}t.exports=o,t.exports.generator=function(n){return n=r(n),function(e,t,r){return n.min=null!=e?e:n.min,n.max=null!=t?t:n.max,n.integer=null!=r?r:n.integer,o(n)}},t.exports.defaults=r}()},{}],145:[function(e,O,t){(function(e,t){"use strict";function m(r,c){if(!r)throw"First parameter is required.";c=new h(r,c=c||{type:"video"});var o=this;function t(e){e&&(c.initCallback=function(){e(),e=c.initCallback=null});var t=new v(r,c);(l=new t(r,c)).record(),a("recording"),c.disableLogs||console.log("Initialized recorderType:",l.constructor.name,"for output-type:",c.type)}function i(n){if(n=n||function(){},l){if("paused"===o.state)return o.resumeRecording(),void setTimeout(function(){i(n)},1);"recording"===o.state||c.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',o.state),c.disableLogs||console.log("Stopped recording "+c.type+" stream."),"gif"!==c.type?l.stop(e):(l.stop(),e()),a("stopped")}else s();function e(e){if(l){Object.keys(l).forEach(function(e){"function"!=typeof l[e]&&(o[e]=l[e])});var t=l.blob;if(!t){if(!e)throw"Recording failed.";l.blob=t=e}if(t&&!c.disableLogs&&console.log(t.type,"->",_(t.size)),n){var r=P.createObjectURL(t);"function"==typeof n.call?n.call(o,r):n(r)}c.autoWriteToDisk&&d(function(e){var t={};t[c.type+"Blob"]=e,x.Store(t)})}else"function"==typeof n.call?n.call(o,""):n("")}}function u(e){postMessage((new FileReaderSync).readAsDataURL(e))}function d(t,e){if(!t)throw"Pass a callback function over getDataURL.";var r,n,o,i=e?e.blob:(l||{}).blob;if(!i)return c.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){d(t,e)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var a=new FileReader;a.readAsDataURL(i),a.onload=function(e){t(e.target.result)}}else{var s=(r=u,n=P.createObjectURL(new Blob([r.toString(),"this.onmessage =  function (e) {"+r.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(n),P.revokeObjectURL(n),o);s.onmessage=function(e){t(e.data)},s.postMessage(i)}}function n(e){e=e||0,"paused"!==o.state?"stopped"!==o.state&&(e>=o.recordingDuration?i(o.onRecordingStopped):(e+=1e3,setTimeout(function(){n(e)},1e3))):setTimeout(function(){n(e)},1e3)}function a(e){o&&(o.state=e,"function"==typeof o.onStateChanged.call?o.onStateChanged.call(o,e):o.onStateChanged(e))}var l,e='It seems that recorder is destroyed or "startRecording" is not invoked for '+c.type+" recorder.";function s(){!0!==c.disableLogs&&console.warn(e)}var f={startRecording:function(e){return e&&(c=new h(r,e)),c.disableLogs||console.log("started recording "+c.type+" stream."),l?(l.clearRecordedData(),l.record(),a("recording"),o.recordingDuration&&n()):t(function(){o.recordingDuration&&n()}),o},stopRecording:i,pauseRecording:function(){l?"recording"===o.state?(a("paused"),l.pause(),c.disableLogs||console.log("Paused recording.")):c.disableLogs||console.warn("Unable to pause the recording. Recording state: ",o.state):s()},resumeRecording:function(){l?"paused"===o.state?(a("recording"),l.resume(),c.disableLogs||console.log("Resumed recording.")):c.disableLogs||console.warn("Unable to resume the recording. Recording state: ",o.state):s()},initRecorder:t,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return o.recordingDuration=e,o.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){o.onRecordingStopped=e}}},clearRecordedData:function(){l?(l.clearRecordedData(),c.disableLogs||console.log("Cleared old recorded data.")):s()},getBlob:function(){if(l)return l.blob;s()},getDataURL:d,toURL:function(){if(l)return P.createObjectURL(l.blob);s()},getInternalRecorder:function(){return l},save:function(e){l?function(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var r=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var n=t.split(".");t=n[0],r=n[1]}var o=(t||Math.round(9999999999*Math.random())+888888888)+"."+r;{if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,o);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,o)}var i=document.createElement("a");i.href=P.createObjectURL(e),i.download=o,i.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(i),"function"==typeof i.click?i.click():(i.target="_blank",i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})));P.revokeObjectURL(i.href)}(l.blob,e):s()},getFromDisk:function(e){l?m.getFromDisk(c.type,e):s()},setAdvertisementArray:function(e){c.advertisement=[];for(var t=e.length,r=0;r<t;r++)c.advertisement.push({duration:r,image:e[r]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){l&&"function"==typeof l.clearRecordedData&&l.clearRecordedData(),l=null,a("inactive"),o.blob=null},onStateChanged:function(e){c.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return o.state},destroy:function(){var e=c.disableLogs;c.disableLogs=!0,o.reset(),c={},a("destroyed"),f=o=null,C.AudioContextConstructor&&(C.AudioContextConstructor.close(),C.AudioContextConstructor=null),e||console.warn("RecordRTC is destroyed.")},version:"5.4.6"};if(!this)return o=f;for(var p in f)this[p]=f[p];return o=this,f}function h(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===u||t.recorderType===c?t.type="video":t.recorderType===f?t.type="gif":t.recorderType===a?t.type="audio":t.recorderType===b&&(e.getAudioTracks().length&&e.getVideoTracks().length?t.type="video":e.getAudioTracks().length&&!e.getVideoTracks().length?t.type="audio":!e.getAudioTracks().length&&e.getVideoTracks().length&&(t.type="audio"))),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function v(e,t){var r;return(d||S||T)&&(r=a),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!d&&(r=b),"video"===t.type&&(d||T)&&(r=u),"gif"===t.type&&(r=f),"canvas"===t.type&&(r=c),l()&&r!==c&&r!==f&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(e.getVideoTracks&&e.getVideoTracks().length||e.getAudioTracks&&e.getAudioTracks().length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(r=b):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(r=b)),t.recorderType&&(r=t.recorderType),e instanceof Array&&e.length&&(r=j),!t.disableLogs&&r&&r.name&&console.log("Using recorderType:",r.name||r.constructor.name),r}function r(a){this.addStream=function(e){e&&(a=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,t=this.mediaType,r=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof t.audio&&l()&&a.getAudioTracks&&!a.getAudioTracks().length&&(t.audio=!1),"function"!=typeof t.video&&l()&&a.getVideoTracks&&!a.getVideoTracks().length&&(t.video=!1),"function"!=typeof t.gif&&l()&&a.getVideoTracks&&!a.getVideoTracks().length&&(t.gif=!1),!t.audio&&!t.video&&!t.gif)throw"MediaStream must have either audio or video tracks.";if(t.audio&&(e=null,"function"==typeof t.audio&&(e=t.audio),this.audioRecorder=new m(a,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:r.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),t.video||this.audioRecorder.startRecording()),t.video){e=null,"function"==typeof t.video&&(e=t.video);var n=a;if(l()&&t.audio&&"function"==typeof t.audio){var o=a.getVideoTracks()[0];navigator.mozGetUserMedia?((n=new g).addTrack(o),e&&e===u&&(e=b)):n=new g([o])}this.videoRecorder=new m(n,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:r.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),t.audio||this.videoRecorder.startRecording()}if(t.audio&&t.video){var i=this;l()?(i.audioRecorder=null,i.videoRecorder.startRecording()):i.videoRecorder.initRecorder(function(){i.audioRecorder.initRecorder(function(){i.videoRecorder.startRecording(),i.audioRecorder.startRecording()})})}t.gif&&(e=null,"function"==typeof t.gif&&(e=t.gif),this.gifRecorder=new m(a,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:r.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(e){t(e,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(e){t(e,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(e){t(e,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(r){function n(e,t){if("undefined"!=typeof Worker){var r=function(e){var t,r=P.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),n=new Worker(r);if(void 0!==P)t=P;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(r),n}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});r.onmessage=function(e){t(e.data)},r.postMessage(e)}else{var n=new FileReader;n.readAsDataURL(e),n.onload=function(e){t(e.target.result)}}}this.getBlob(function(e){e.audio&&e.video?n(e.audio,function(t){n(e.video,function(e){r({audio:t,video:e})})}):e.audio?n(e.audio,function(e){r({audio:e})}):e.video&&n(e.video,function(e){r({video:e})})})},this.writeToDisk=function(){m.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}m.version="5.4.6",void 0!==O&&(O.exports=m),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return m}),m.getFromDisk=function(r,n){if(!n)throw"callback is mandatory.";console.log("Getting recorded "+("all"===r?"blobs":r+" blob ")+" from disk!"),x.Fetch(function(e,t){"all"!==r&&t===r+"Blob"&&n&&n(e),"all"===r&&n&&n(e,t.replace("Blob",""))})},m.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL(function(r){e.video.getDataURL(function(t){e.gif.getDataURL(function(e){x.Store({audioBlob:r,videoBlob:t,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){x.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){x.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){x.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){x.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){x.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){x.Store({gifBlob:e})})},r.getFromDisk=m.getFromDisk,r.writeToDisk=m.writeToDisk,m.MRecordRTC=r;var n;(n=void 0!==t?t:null)&&"undefined"==typeof window&&void 0!==t&&(t.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},t.console||(t.console={}),void 0!==t.console.log&&void 0!==t.console.error||(t.console.error=t.console.log=t.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(n.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},n.HTMLVideoElement=function(){}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),void 0===P&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=t);var p=window.requestAnimationFrame;if(void 0===p)if("undefined"!=typeof webkitRequestAnimationFrame)p=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)p=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)p=msRequestAnimationFrame;else if(void 0===p){var i=0;p=function(e,t){var r=(new Date).getTime(),n=Math.max(0,16-(r-i)),o=setTimeout(function(){e(r+n)},n);return i=r+n,o}}var y=window.cancelAnimationFrame;void 0===y&&("undefined"!=typeof webkitCancelAnimationFrame?y=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?y=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?y=msCancelAnimationFrame:void 0===y&&(y=function(e){clearTimeout(e)}));var o=window.AudioContext;void 0===o&&("undefined"!=typeof webkitAudioContext&&(o=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(o=mozAudioContext));var P=window.URL;void 0===P&&"undefined"!=typeof webkitURL&&(P=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var S=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),T=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),R=-1<navigator.userAgent.toLowerCase().indexOf("safari/"),d=!T&&!S&&!!navigator.webkitGetUserMedia||s()||R,g=window.MediaStream;function _(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function s(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!(void 0===e||"object"!=typeof e.versions||!e.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron"))}function w(t,r,e){if("createObjectURL"in P&&!e)try{r.src=P.createObjectURL(t)}catch(e){return void w(t,r,!0)}else"srcObject"in r?r.srcObject=t:"mozSrcObject"in r?r.mozSrcObject=t:alert("createObjectURL/srcObject both are not supported.")}void 0===g&&"undefined"!=typeof webkitMediaStream&&(g=webkitMediaStream),void 0!==g&&("getVideoTracks"in g.prototype||(g.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks().forEach(function(e){-1!==e.kind.toString().indexOf("video")&&t.push(e)}),t},g.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks().forEach(function(e){-1!==e.kind.toString().indexOf("audio")&&t.push(e)}),t}),void 0===g.prototype.stop&&(g.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}));var C={};function l(){var e=!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),t=!!window.chrome&&!e||s();if(void 0!==window.InstallTrigger)return!0;navigator.appVersion;var r,n,o=navigator.userAgent,i=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);return(t||e)&&(r=o.indexOf("Chrome"),i=o.substring(r+7)),-1!==(n=i.indexOf(";"))&&(i=i.substring(0,n)),-1!==(n=i.indexOf(" "))&&(i=i.substring(0,n)),a=parseInt(""+i,10),isNaN(a)&&(i=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),49<=a}function b(t,n){var o=this;if(void 0===t)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not supports Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if("audio"===(n=n||{mimeType:"video/webm"}).type){var e;if(t.getVideoTracks().length&&t.getAudioTracks().length)navigator.mozGetUserMedia?(e=new g).addTrack(t.getAudioTracks()[0]):e=new g(t.getAudioTracks()),t=e;n.mimeType&&-1!==n.mimeType.toString().toLowerCase().indexOf("audio")||(n.mimeType=d?"audio/webm":"audio/ogg"),n.mimeType&&"audio/ogg"!==n.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(n.mimeType="audio/ogg")}var i,a=[];function s(){o.timestamps.push((new Date).getTime()),"function"==typeof n.onTimeStamp&&n.onTimeStamp(o.timestamps[o.timestamps.length-1],o.timestamps)}function c(e){return i&&i.mimeType?i.mimeType:e.mimeType||"video/webm"}function r(){a=[],i=null,o.timestamps=[]}this.getArrayOfBlobs=function(){return a},this.record=function(){o.blob=null,o.clearRecordedData(),o.timestamps=[],u=[],a=[];var r=n;n.disableLogs||console.log("Passing following config over MediaRecorder API.",r),i&&(i=null),d&&!l()&&(r="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&r.mimeType&&(MediaRecorder.isTypeSupported(r.mimeType)||(n.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",r.mimeType),r.mimeType="audio"===n.type?"audio/webm":"video/webm"));try{i=new MediaRecorder(t,r),n.mimeType=r.mimeType}catch(e){i=new MediaRecorder(t)}r.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in i&&!1===i.canRecordMimeType(r.mimeType)&&(n.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",r.mimeType)),i.ignoreMutedMedia=!0===n.ignoreMutedMedia,i.ondataavailable=function(e){if(e.data&&u.push("ondataavailable: "+_(e.data.size)),"number"!=typeof n.timeSlice)!e.data||!e.data.size||e.data.size<100||o.blob?o.recordingCallback&&(o.recordingCallback(new Blob([],{type:c(r)})),o.recordingCallback=null):(o.blob=n.getNativeBlob?e.data:new Blob([e.data],{type:c(r)}),o.recordingCallback&&(o.recordingCallback(o.blob),o.recordingCallback=null));else if(e.data&&e.data.size&&100<e.data.size&&(a.push(e.data),s(),"function"==typeof n.ondataavailable)){var t=n.getNativeBlob?e.data:new Blob([e.data],{type:c(r)});n.ondataavailable(t)}},i.onstart=function(){u.push("started")},i.onpause=function(){u.push("paused")},i.onresume=function(){u.push("resumed")},i.onstop=function(){u.push("stopped")},i.onerror=function(e){u.push("error: "+e),n.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",r.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),function(e){if(!o.manuallyStopped&&i&&"inactive"===i.state)return delete n.timeslice,i.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==i.state&&"stopped"!==i.state&&i.stop()},"number"==typeof n.timeSlice?(s(),i.start(n.timeSlice)):i.start(36e5),n.initCallback&&n.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},o.manuallyStopped=!0,i&&(this.recordingCallback=e,"recording"===i.state&&i.stop(),"number"==typeof n.timeSlice&&setTimeout(function(){o.blob=new Blob(a,{type:c(n)}),o.recordingCallback(o.blob)},100))},this.pause=function(){i&&"recording"===i.state&&i.pause()},this.resume=function(){i&&"paused"===i.state&&i.resume()},this.clearRecordedData=function(){i&&"recording"===i.state&&o.stop(r),r()},this.getInternalRecorder=function(){return i},this.blob=null,this.getState=function(){return i&&i.state||"inactive"};var u=[];this.getAllStates=function(){return u},void 0===n.checkForInactiveTracks&&(n.checkForInactiveTracks=!1);o=this;!function e(){if(i&&!1!==n.checkForInactiveTracks)return!1===function(){if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}()?(n.disableLogs||console.log("MediaStream seems stopped."),void o.stop()):void setTimeout(e,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function a(e,i){if(!e.getAudioTracks().length)throw"Your stream has no audio tracks.";var a,s=this,c=[],u=[],d=!1,l=0,f=2,n=(i=i||{}).desiredSampRate;function p(){if(!1===i.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function t(e,t){function r(e,t){var r,n=e.numberOfAudioChannels,o=e.leftBuffers.slice(0),i=e.rightBuffers.slice(0),a=e.sampleRate,s=e.internalInterleavedLength,c=e.desiredSampRate;function u(e,t,r){var n,o,i=Math.round(e.length*(t/r)),a=[],s=Number((e.length-1)/(i-1));a[0]=e[0];for(var c=1;c<i-1;c++){var u=c*s,d=Number(Math.floor(u)).toFixed(),l=Number(Math.ceil(u)).toFixed(),f=u-d;a[c]=(n=e[d],o=e[l],n+(o-n)*f)}return a[i-1]=e[e.length-1],a}function d(e,t){for(var r=new Float64Array(t),n=0,o=e.length,i=0;i<o;i++){var a=e[i];r.set(a,n),n+=a.length}return r}function l(e,t,r){for(var n=r.length,o=0;o<n;o++)e.setUint8(t+o,r.charCodeAt(o))}2===n&&(o=d(o,s),i=d(i,s),c&&(o=u(o,c,a),i=u(i,c,a))),1===n&&(o=d(o,s),c&&(o=u(o,c,a))),c&&(a=c),2===n&&(r=function(e,t){for(var r=e.length+t.length,n=new Float64Array(r),o=0,i=0;i<r;)n[i++]=e[o],n[i++]=t[o],o++;return n}(o,i)),1===n&&(r=o);var f=r.length,p=new ArrayBuffer(44+2*f),m=new DataView(p);l(m,0,"RIFF"),m.setUint32(4,44+2*f,!0),l(m,8,"WAVE"),l(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,n,!0),m.setUint32(24,a,!0),m.setUint32(28,2*a,!0),m.setUint16(32,2*n,!0),m.setUint16(34,16,!0),l(m,36,"data"),m.setUint32(40,2*f,!0);for(var h=f,v=44,y=0;y<h;y++)m.setInt16(v,32767*r[y],!0),v+=2;if(t)return t({buffer:p,view:m});postMessage({buffer:p,view:m})}if(S||T||R||e.noWorker)r(e,function(e){t(e.buffer,e.view)});else{var n,o,i,a=(n=r,o=P.createObjectURL(new Blob([n.toString(),";this.onmessage =  function (e) {"+n.name+"(e.data);}"],{type:"application/javascript"})),(i=new Worker(o)).workerURL=o,i);a.onmessage=function(e){t(e.data.buffer,e.data.view),P.revokeObjectURL(a.workerURL)},a.postMessage(e)}}!0===i.leftChannel&&(f=1),1===i.numberOfAudioChannels&&(f=1),(!f||f<1)&&(f=2),i.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: ",f),void 0===i.checkForInactiveTracks&&(i.checkForInactiveTracks=!0),this.record=function(){if(!1===p())throw"Please make sure MediaStream is active.";g(),b=y=!1,d=!0,void 0!==i.timeSlice&&k()},this.stop=function(r){r=r||function(){},d=!1,t({desiredSampRate:n,sampleRate:v,numberOfAudioChannels:f,internalInterleavedLength:l,leftBuffers:c,rightBuffers:1===f?[]:u},function(e,t){s.blob=new Blob([t],{type:"audio/wav"}),s.buffer=new ArrayBuffer(t.buffer.byteLength),s.view=t,s.sampleRate=n||v,s.bufferSize=h,s.length=l,b=!1,r&&r(s.blob)})},C.AudioContextConstructor||(C.AudioContextConstructor=new C.AudioContext);var r=C.AudioContextConstructor,m=r.createMediaStreamSource(e),o=[0,256,512,1024,2048,4096,8192,16384],h=void 0===i.bufferSize?4096:i.bufferSize;if(-1===o.indexOf(h)&&(i.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(o,null,"\t"))),r.createJavaScriptNode)a=r.createJavaScriptNode(h,f,f);else{if(!r.createScriptProcessor)throw"WebAudio API has no support on this browser.";a=r.createScriptProcessor(h,f,f)}m.connect(a),i.bufferSize||(h=a.bufferSize);var v=void 0!==i.sampleRate?i.sampleRate:r.sampleRate||44100;(v<22050||96e3<v)&&(i.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.")),i.disableLogs||(console.log("sample-rate",v),console.log("buffer-size",h),i.desiredSampRate&&console.log("Desired sample-rate",i.desiredSampRate));var y=!1;function g(){c=[],l=0,y=d=b=!(u=[]),r=null,s.leftchannel=c,s.rightchannel=u,s.numberOfAudioChannels=f,s.desiredSampRate=n,s.sampleRate=v,s.recordingLength=l,w={left:[],right:[],recordingLength:0}}function _(){a&&(a.onaudioprocess=null,a.disconnect(),a=null),m&&(m.disconnect(),m=null),g()}this.pause=function(){y=!0},this.resume=function(){if(!1===p())throw"Please make sure MediaStream is active.";if(!d)return i.disableLogs||console.log("Seems recording has been restarted."),void this.record();y=!1},this.clearRecordedData=function(){i.checkForInactiveTracks=!1,d&&this.stop(_),_()},this.name="StereoAudioRecorder";var b=!(this.toString=function(){return this.name});a.onaudioprocess=function(e){if(!y)if(!1===p()&&(i.disableLogs||console.log("MediaStream seems stopped."),a.disconnect(),d=!1),d){b||(b=!0,i.onAudioProcessStarted&&i.onAudioProcessStarted(),i.initCallback&&i.initCallback());var t=e.inputBuffer.getChannelData(0),r=new Float32Array(t);if(c.push(r),2===f){var n=e.inputBuffer.getChannelData(1),o=new Float32Array(n);u.push(o)}l+=h,s.recordingLength=l,void 0!==i.timeSlice&&(w.recordingLength+=h,w.left.push(r),2===f&&w.right.push(o))}else m&&(m.disconnect(),m=null)},a.connect(r.destination),this.leftchannel=c,this.rightchannel=u,this.numberOfAudioChannels=f,this.desiredSampRate=n,this.sampleRate=v,s.recordingLength=l;var w={left:[],right:[],recordingLength:0};function k(){d&&"function"==typeof i.ondataavailable&&void 0!==i.timeSlice&&(w.left.length?(t({desiredSampRate:n,sampleRate:v,numberOfAudioChannels:f,internalInterleavedLength:w.recordingLength,leftBuffers:w.left,rightBuffers:1===f?[]:w.right},function(e,t){var r=new Blob([t],{type:"audio/wav"});i.ondataavailable(r),setTimeout(k,i.timeSlice)}),w={left:[],right:[],recordingLength:0}):setTimeout(k,i.timeSlice))}}function c(n,i){if("undefined"==typeof html2canvas)throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";(i=i||{}).frameInterval||(i.frameInterval=10);var o=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(o=!0)});var r,a,s,e=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),t=50,c=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e&&c&&c[2]&&(t=parseInt(c[2],10)),e&&t<52&&(o=!1),o)if(i.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),n instanceof HTMLCanvasElement)r=n;else{if(!(n instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";r=n.canvas}else navigator.mozGetUserMedia&&(i.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(s=!0,o&&!i.useWhammyRecorder){var e;"captureStream"in r?e=r.captureStream(25):"mozCaptureStream"in r?e=r.mozCaptureStream(25):"webkitCaptureStream"in r&&(e=r.webkitCaptureStream(25));try{var t=new g;t.addTrack(e.getVideoTracks()[0]),e=t}catch(e){}if(!e)throw"captureStream API are NOT available.";(a=new b(e,{mimeType:"video/webm"})).record()}else p.frames=[],f=(new Date).getTime(),l();i.initCallback&&i.initCallback()},this.getWebPImages=function(e){if("canvas"===n.nodeName.toLowerCase()){var o=p.frames.length;p.frames.forEach(function(e,t){var r=o-t;i.disableLogs||console.log(r+"/"+o+" frames remaining"),i.onEncodingCallback&&i.onEncodingCallback(r,o);var n=e.image.toDataURL("image/webp",1);p.frames[t].image=n}),i.disableLogs||console.log("Generating WebM"),e()}else e()};var u=!(this.stop=function(t){s=!1;var r=this;o&&a?a.stop(t):this.getWebPImages(function(){p.compile(function(e){i.disableLogs||console.log("Recording finished!"),r.blob=e,r.blob.forEach&&(r.blob=new Blob([],{type:"video/webm"})),t&&t(r.blob),p.frames=[]})})});function d(){p.frames=[],u=s=!1}function l(){if(u)return f=(new Date).getTime(),setTimeout(l,500);if("canvas"===n.nodeName.toLowerCase()){var e=(new Date).getTime()-f;return f=(new Date).getTime(),p.frames.push({image:(t=document.createElement("canvas"),r=t.getContext("2d"),t.width=n.width,t.height=n.height,r.drawImage(n,0,0),t),duration:e}),void(s&&setTimeout(l,i.frameInterval))}var t,r;html2canvas(n,{grabMouse:void 0===i.showMousePointer||i.showMousePointer,onrendered:function(e){var t=(new Date).getTime()-f;if(!t)return setTimeout(l,i.frameInterval);f=(new Date).getTime(),p.frames.push({image:e.toDataURL("image/webp",1),duration:t}),s&&setTimeout(l,i.frameInterval)}})}this.pause=function(){u=!0,a instanceof b&&a.pause()},this.resume=function(){u=!1,a instanceof b?a.resume():s||this.record()},this.clearRecordedData=function(){s&&this.stop(d),d()},this.name="CanvasRecorder",this.toString=function(){return this.name};var f=(new Date).getTime(),p=new k.Video(100)}function u(e,n){function r(e){e=void 0!==e?e:10;var t=(new Date).getTime()-c;return t?a?(c=(new Date).getTime(),setTimeout(r,100)):(c=(new Date).getTime(),s.paused&&s.play(),d.drawImage(s,0,0,b.width,b.height),u.frames.push({duration:t,image:b.toDataURL("image/webp")}),void(i||setTimeout(r,e,e))):setTimeout(r,e,e)}function o(r,e,t,n,o){var i=document.createElement("canvas");i.width=b.width,i.height=b.height;var a,s,c,d=i.getContext("2d"),l=[],f=-1===e,u=e&&0<e&&e<=r.length?e:r.length,p=0,m=0,h=0,v=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),y=t&&0<=t&&t<=1?t:0,g=n&&0<=n&&n<=1?n:0,_=!1;s=-1,c=(a={length:u,functionToLoop:function(e,t){var i,a,s,c=function(){!_&&s-i<=s*g||(f&&(_=!0),l.push(r[t])),e()};if(_)c();else{var u=new Image;u.onload=function(){d.drawImage(u,0,0,b.width,b.height);var e=d.getImageData(0,0,b.width,b.height);i=0,a=e.data.length,s=e.data.length/4;for(var t=0;t<a;t+=4){var r=e.data[t],n=e.data[t+1],o=e.data[t+2];Math.sqrt(Math.pow(r-p,2)+Math.pow(n-m,2)+Math.pow(o-h,2))<=v*y&&i++}c()},u.src=r[t].image}},callback:function(){(l=l.concat(r.slice(u))).length<=0&&l.push(r[r.length-1]),o(l)}}).length,function e(){++s!==c?setTimeout(function(){a.functionToLoop(e,s)},1):a.callback()}()}(n=n||{}).frameInterval||(n.frameInterval=10),n.disableLogs||console.log("Using frames-interval:",n.frameInterval);var i=!(this.record=function(){n.width||(n.width=320),n.height||(n.height=240),n.video||(n.video={width:n.width,height:n.height}),n.canvas||(n.canvas={width:n.width,height:n.height}),b.width=n.canvas.width||320,b.height=n.canvas.height||240,d=b.getContext("2d"),n.video&&n.video instanceof HTMLVideoElement?(s=n.video.cloneNode(),n.initCallback&&n.initCallback()):(s=document.createElement("video"),w(e,s),s.onloadedmetadata=function(){n.initCallback&&n.initCallback()},s.width=n.video.width,s.height=n.video.height),s.muted=!0,s.play(),c=(new Date).getTime(),u=new k.Video,n.disableLogs||(console.log("canvas resolutions",b.width,"*",b.height),console.log("video width/height",s.width||b.width,"*",s.height||b.height)),r(n.frameInterval)}),a=!(this.stop=function(t){t=t||function(){},i=!0;var r=this;setTimeout(function(){o(u.frames,-1,null,null,function(e){u.frames=e,n.advertisement&&n.advertisement.length&&(u.frames=n.advertisement.concat(u.frames)),u.compile(function(e){r.blob=e,r.blob.forEach&&(r.blob=new Blob([],{type:"video/webm"})),t&&t(r.blob)})})},10)});function t(){u.frames=[],a=!(i=!0)}this.pause=function(){a=!0},this.resume=function(){a=!1,i&&this.record()},this.clearRecordedData=function(){i||this.stop(t),t()},this.name="WhammyRecorder",this.toString=function(){return this.name};var s,c,u,b=document.createElement("canvas"),d=b.getContext("2d")}void 0!==o?C.AudioContext=o:"undefined"!=typeof webkitAudioContext&&(C.AudioContext=webkitAudioContext),m.Storage=C,m.MediaStreamRecorder=b,m.StereoAudioRecorder=a,m.CanvasRecorder=c,m.WhammyRecorder=u;var k=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function i(e){function u(e,r,t){return[{data:e,id:231}].concat(t.map(function(e){var t=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(r)});return r+=e.duration,{data:t,id:163}}))}function d(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function l(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var r=0;r<e.length;r+=8)t.push(parseInt(e.substr(r,8),2));return new Uint8Array(t)}var t=new function(e){var t=function(e){if(e[0]){for(var t=e[0].width,r=e[0].height,n=e[0].duration,o=1;o<e.length;o++)n+=e[o].duration;return{duration:n,width:t,height:r}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!t)return[];for(var r,n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(r=t.duration,[].slice.call(new Uint8Array(new Float64Array([r]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],o=0,i=0;o<e.length;){for(var a=[],s=0;a.push(e[o]),s+=e[o].duration,++o<e.length&&s<3e4;);var c={id:524531317,data:u(i,0,a)};n[1].data.push(c),i+=s}return function e(t){for(var r=[],n=0;n<t.length;n++){var o=t[n].data;"object"==typeof o&&(o=e(o)),"number"==typeof o&&(o=l(o.toString(2))),"string"==typeof o&&(o=new Uint8Array(o.split("").map(function(e){return e.charCodeAt(0)})));var i=o.size||o.byteLength||o.length,a=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),s=i.toString(2),c=new Array(7*a+7+1-s.length).join("0")+s,u=new Array(a).join("0")+"1"+c;r.push(d(t[n].id)),r.push(l(u)),r.push(o)}return new Blob(r,{type:"video/webm"})}(n)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],r=t.indexOf("*"),n=0,o=[];n<4;n++)o[n]=t.charCodeAt(r+3+n);return{width:16383&(o[1]<<8|o[0]),height:16383&(o[3]<<8|o[2]),data:t,riff:e}}(function e(t){for(var r,n=0,o={};n<t.length;){var i=t.substr(n,4),a=(r=n,parseInt(t.substr(r+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)),s=t.substr(n+4+4,a);n+=8+a,o[i]=o[i]||[],"RIFF"===i||"LIST"===i?o[i].push(e(s)):o[i].push(s)}return o}(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(t)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(t){var e,r,n,o=(e=i,r=P.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),n=new Worker(r),P.revokeObjectURL(r),n);o.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},o.postMessage(this.frames)},{Video:e}}();m.Whammy=k;var x={init:function(){var r=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var n,e=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),t=indexedDB.open(e,1);t.onerror=r.onError,t.onsuccess=function(){((n=t.result).onerror=r.onError,n.setVersion)?1!==n.version?n.setVersion(1).onsuccess=function(){o(n),i()}:i():i()},t.onupgradeneeded=function(e){o(e.target.result)}}else console.error("IndexedDB API are not available in this browser.");function o(e){e.createObjectStore(r.dataStoreName)}function i(){var e=n.transaction([r.dataStoreName],"readwrite");function t(t){e.objectStore(r.dataStoreName).get(t).onsuccess=function(e){r.callback&&r.callback(e.target.result,t)}}r.videoBlob&&e.objectStore(r.dataStoreName).put(r.videoBlob,"videoBlob"),r.gifBlob&&e.objectStore(r.dataStoreName).put(r.gifBlob,"gifBlob"),r.audioBlob&&e.objectStore(r.dataStoreName).put(r.audioBlob,"audioBlob"),t("audioBlob"),t("videoBlob"),t("gifBlob")}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function f(e,r){if("undefined"==typeof GIFEncoder){var t=document.createElement("script");t.src="https://cdn.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}r=r||{};var n=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&s?(n||(r.width||(r.width=c.offsetWidth||320),r.height||(r.height=c.offsetHeight||240),r.video||(r.video={width:r.width,height:r.height}),r.canvas||(r.canvas={width:r.width,height:r.height}),i.width=r.canvas.width||320,i.height=r.canvas.height||240,c.width=r.video.width||320,c.height=r.video.height||240),(d=new GIFEncoder).setRepeat(0),d.setDelay(r.frameRate||200),d.setQuality(r.quality||10),d.start(),"function"==typeof r.onGifRecordingStarted&&r.onGifRecordingStarted(),Date.now(),l=p(function e(t){if(!0!==f.clearedRecordedData){if(o)return setTimeout(function(){e(t)},100);l=p(e),void 0===typeof u&&(u=t),t-u<90||(!n&&c.paused&&c.play(),n||a.drawImage(c,0,0,i.width,i.height),r.onGifPreview&&r.onGifPreview(i.toDataURL("image/png")),d.addFrame(a),u=t)}}),r.initCallback&&r.initCallback()):setTimeout(f.record,1e3)};var o=!(this.stop=function(e){e=e||function(){},l&&y(l),Date.now(),this.blob=new Blob([new Uint8Array(d.stream().bin)],{type:"image/gif"}),e(this.blob),d.stream().bin=[]});this.pause=function(){o=!0},this.resume=function(){o=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,d&&(d.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var i=document.createElement("canvas"),a=i.getContext("2d");n&&(e instanceof CanvasRenderingContext2D?i=(a=e).canvas:e instanceof HTMLCanvasElement&&(a=e.getContext("2d"),i=e));var s=!0;if(!n){var c=document.createElement("video");c.muted=!0,c.autoplay=!0,s=!1,c.onloadedmetadata=function(){s=!0},w(e,c),c.play()}var u,d,l=null,f=this}function E(n){var o=[],a=!1,i=document.createElement("canvas"),s=i.getContext("2d");i.style="opacity:0;position:absolute;z-index:-1;top: -100000000;left:-1000000000; margin-top:-1000000000;margin-left:-1000000000;",(document.body||document.documentElement).appendChild(i),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var c=this,e=window.AudioContext;void 0===e&&("undefined"!=typeof webkitAudioContext&&(e=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(e=mozAudioContext));var u=window.URL;void 0===u&&"undefined"!=typeof webkitURL&&(u=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var r=window.MediaStream;void 0===r&&"undefined"!=typeof webkitMediaStream&&(r=webkitMediaStream),void 0!==r&&("getVideoTracks"in r.prototype||(r.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("video")&&t.push(e)}),t},r.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var t=[];return this.getTracks.forEach(function(e){-1!==e.kind.toString().indexOf("audio")&&t.push(e)}),t}),void 0===r.prototype.stop&&(r.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}));var d={};function l(){if(!a){var e=o.length,t=!1,r=[];if(o.forEach(function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:r.push(e)}),t)i.width=t.stream.width,i.height=t.stream.height;else if(r.length){i.width=1<e?2*r[0].width:r[0].width;var n=1;3!==e&&4!==e||(n=2),5!==e&&6!==e||(n=3),7!==e&&8!==e||(n=4),9!==e&&10!==e||(n=5),i.height=r[0].height*n}else i.width=c.width||360,i.height=c.height||240;t&&t instanceof HTMLVideoElement&&f(t),r.forEach(function(e,t){f(e,t)}),setTimeout(l,c.frameInterval)}}function f(e,t){if(!a){var r=0,n=0,o=e.width,i=e.height;1===t&&(r=e.width),2===t&&(n=e.height),3===t&&(r=e.width,n=e.height),4===t&&(n=2*e.height),5===t&&(r=e.width,n=2*e.height),6===t&&(n=3*e.height),7===t&&(r=e.width,n=3*e.height),void 0!==e.stream.left&&(r=e.stream.left),void 0!==e.stream.top&&(n=e.stream.top),void 0!==e.stream.width&&(o=e.stream.width),void 0!==e.stream.height&&(i=e.stream.height),s.drawImage(e,r,n,o,i),"function"==typeof e.stream.onRender&&e.stream.onRender(s,r,n,o,i,t)}}function p(e){var t=document.createElement("video");return function t(r,n,e){if("createObjectURL"in u&&!e)try{n.src=u.createObjectURL(r)}catch(e){return void t(r,n,!0)}else"srcObject"in n?n.srcObject=r:"mozSrcObject"in n?n.mozSrcObject=r:alert("createObjectURL/srcObject both are not supported.")}(e,t),t.muted=!0,t.volume=0,t.width=e.width||c.width||360,t.height=e.height||c.height||240,t.play(),t}function m(e){o=[],(e=e||n).forEach(function(e){if(e.getVideoTracks().length){var t=p(e);t.stream=e,o.push(t)}})}void 0!==e?d.AudioContext=e:"undefined"!=typeof webkitAudioContext&&(d.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){l()},this.appendStreams=function(e){if(!e)throw"First parameter is required.";e instanceof Array||(e=[e]),n.concat(e),e.forEach(function(e){if(e.getVideoTracks().length){var t=p(e);t.stream=e,o.push(t)}if(e.getAudioTracks().length&&c.audioContext){var r=c.audioContext.createMediaStreamSource(e);r.connect(c.audioDestination),c.audioSources.push(r)}})},this.releaseStreams=function(){o=[],a=!0,c.gainNode&&(c.gainNode.disconnect(),c.gainNode=null),c.audioSources.length&&(c.audioSources.forEach(function(e){e.disconnect()}),c.audioSources=[]),c.audioDestination&&(c.audioDestination.disconnect(),c.audioDestination=null),c.audioContext=null,s.clearRect(0,0,i.width,i.height),i.stream&&(i.stream.stop(),i.stream=null)},this.resetVideoStreams=function(e){!e||e instanceof Array||(e=[e]),m(e)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){a=!1;var t=function(){var e;m(),"captureStream"in i?e=i.captureStream():"mozCaptureStream"in i?e=i.mozCaptureStream():c.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new r;return e.getVideoTracks().forEach(function(e){t.addTrack(e)}),i.stream=t}(),e=function(){d.AudioContextConstructor||(d.AudioContextConstructor=new d.AudioContext),c.audioContext=d.AudioContextConstructor,c.audioSources=[],!0===c.useGainNode&&(c.gainNode=c.audioContext.createGain(),c.gainNode.connect(c.audioContext.destination),c.gainNode.gain.value=0);var r=0;if(n.forEach(function(e){if(e.getAudioTracks().length){r++;var t=c.audioContext.createMediaStreamSource(e);!0===c.useGainNode&&t.connect(c.gainNode),c.audioSources.push(t)}}),r)return c.audioDestination=c.audioContext.createMediaStreamDestination(),c.audioSources.forEach(function(e){e.connect(c.audioDestination)}),c.audioDestination.stream}();return e&&e.getAudioTracks().forEach(function(e){t.addTrack(e)}),n.forEach(function(e){e.fullcanvas}),t}}function j(r,e){r=r||[];var n,o,i=this;(e=e||{mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){var t;n=new E(r),(t=[],r.forEach(function(e){e.getVideoTracks().forEach(function(e){t.push(e)})}),t).length&&(n.frameInterval=e.frameInterval||10,n.width=e.video.width||360,n.height=e.video.height||240,n.startDrawingFrames()),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(n.getMixedStream()),(o=new b(n.getMixedStream(),e)).record()},this.stop=function(t){o&&o.stop(function(e){i.blob=e,t(e),i.clearRecordedData()})},this.pause=function(){o&&o.pause()},this.resume=function(){o&&o.resume()},this.clearRecordedData=function(){o&&(o.clearRecordedData(),o=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(e){if(!e)throw"First parameter is required.";e instanceof Array||(e=[e]),r.concat(e),o&&n&&n.appendStreams(e)},this.resetVideoStreams=function(e){n&&(!e||e instanceof Array||(e=[e]),n.resetVideoStreams(e))},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}m.DiskStorage=x,m.GifRecorder=f,m.MultiStreamRecorder=j,m.RecordRTCPromisesHandler=function(e,t){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var n=this;n.recordRTC=new m(e,t),this.startRecording=function(){return new Promise(function(e,t){try{n.recordRTC.startRecording(),e()}catch(e){t(e)}})},this.stopRecording=function(){return new Promise(function(t,r){try{n.recordRTC.stopRecording(function(e){n.blob=n.recordRTC.getBlob(),t(e)})}catch(e){r(e)}})},this.getDataURL=function(e){return new Promise(function(t,r){try{n.recordRTC.getDataURL(function(e){t(e)})}catch(e){r(e)}})},this.getBlob=function(){return n.recordRTC.getBlob()},this.blob=null}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:136}],146:[function(e,t,r){t.exports=e("./lib/retry")},{"./lib/retry":147}],147:[function(e,t,s){var r=e("./retry_operation");s.operation=function(e){var t=s.timeouts(e);return new r(t,{forever:e&&e.forever,unref:e&&e.unref})},s.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<t.retries;o++)n.push(this.createTimeout(o,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(o,t)),n.sort(function(e,t){return e-t}),n},s.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},s.wrap=function(n,o,e){if(o instanceof Array&&(e=o,o=null),!e)for(var t in e=[],n)"function"==typeof n[t]&&e.push(t);for(var r=0;r<e.length;r++){var i=e[r],a=n[i];n[i]=function(){var t=s.operation(o),e=Array.prototype.slice.call(arguments),r=e.pop();e.push(function(e){t.retry(e)||(e&&(arguments[0]=t.mainError()),r.apply(this,arguments))}),t.attempt(function(){a.apply(n,e)})},n[i].options=o}}},{"./retry_operation":148}],148:[function(e,t,r){function n(e,t){"boolean"==typeof t&&(t={forever:t}),this._timeouts=e,this._options=t||{},this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}(t.exports=n).prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;this._errors.push(e);var t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var r=this,n=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),this._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t);return this._options.unref&&n.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,a=(e[i]||0)+1;r<=(e[i]=a)&&(t=o,r=a)}return t}},{}],149:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],150:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":151,"./writer":152}],151:[function(e,t,r){var i=function(e){return String(Number(e))===e?Number(e):e},s=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=i(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=i(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},c=e("./grammar"),n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},i=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(n).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),a=i[i.length-1]);for(var n=0;n<(c[t]||[]).length;n+=1){var o=c[t][n];if(o.reg.test(r))return s(o,a,r)}}),t.media=i,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/\;\s?/).reduce(o,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":149}],152:[function(e,t,r){var i=e("./grammar"),a=/%[sdv%]/g,s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return function(e){var r=1,n=arguments,o=n.length;return e.replace(a,function(e){if(o<=r)return e;var t=n[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,n)},c=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||c,n=t.innerOrder||u,o=[];return r.forEach(function(r){i[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(s(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(s(r,t,e))})})}),e.media.forEach(function(e){o.push(s("m",i.m[0],e)),n.forEach(function(r){i[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(s(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(s(r,t,e))})})})}),o.join("\r\n")+"\r\n"}},{"./grammar":149}],153:[function(e,t,r){var n=function(){return this}(),o=n.WebSocket||n.MozWebSocket,i=e("./version");function a(e,t){return t?new o(e,t):new o(e)}o&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(a,e,{get:function(){return o[e]}})}),t.exports={w3cwebsocket:o?a:null,version:i}},{"./version":154}],154:[function(e,t,r){t.exports=e("../package.json").version},{"../package.json":155}],155:[function(e,t,r){t.exports={_args:[[{raw:"websocket@^1.0.25",scope:null,escapedName:"websocket",name:"websocket",rawSpec:"^1.0.25",spec:">=1.0.25 <2.0.0",type:"range"},"E:\\shinevvJsSdk\\app\\node_modules\\protoo-client"]],_cnpm_publish_time:1508372613360,_from:"websocket@>=1.0.25 <2.0.0",_hasShrinkwrap:!1,_id:"websocket@1.0.25",_inCache:!0,_location:"/websocket",_nodeVersion:"8.7.0",_npmOperationalInternal:{host:"s3://npm-registry-packages",tmp:"tmp/websocket-1.0.25.tgz_1508372613263_0.2284609314519912"},_npmUser:{name:"theturtle32",email:"theturtle32@gmail.com"},_npmVersion:"5.4.2",_phantomChildren:{ms:"2.0.0"},_requested:{raw:"websocket@^1.0.25",scope:null,escapedName:"websocket",name:"websocket",rawSpec:"^1.0.25",spec:">=1.0.25 <2.0.0",type:"range"},_requiredBy:["/protoo-client"],_resolved:"http://registry.npm.taobao.org/websocket/download/websocket-1.0.25.tgz",_shasum:"998ec790f0a3eacb8b08b50a4350026692a11958",_shrinkwrap:null,_spec:"websocket@^1.0.25",_where:"E:\\shinevvJsSdk\\app\\node_modules\\protoo-client",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:!1},contributors:[{name:"Iaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.6"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.0.1"},directories:{lib:"./lib"},dist:{shasum:"998ec790f0a3eacb8b08b50a4350026692a11958",size:42743,noattachment:!1,tarball:"http://registry.npm.taobao.org/websocket/download/websocket-1.0.25.tgz"},engines:{node:">=0.10.0"},gitHead:"d941f975e8ef6b55eafc0ef45996f4198013832c",homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],name:"websocket",optionalDependencies:{},publish_time:1508372613360,readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.25"}},{}],156:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/createClass")),i=a(e("debug"));function a(e){return e&&e.__esModule?e:{default:e}}var s="Shinevv",c=function(){function t(e){(0,n.default)(this,t),e?(this._debug=(0,i.default)(s+":"+e),this._warn=(0,i.default)(s+":WARN:"+e),this._error=(0,i.default)(s+":ERROR:"+e)):(this._debug=(0,i.default)(s),this._warn=(0,i.default)(s+":WARN"),this._error=(0,i.default)(s+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,o.default)(t,[{key:"debug",get:function(){return console.log}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),t}();r.default=c},{"babel-runtime/helpers/classCallCheck":7,"babel-runtime/helpers/createClass":8,debug:109}],157:[function(e,t,r){"use strict";var n,o=e("./Shinevv.js"),i=(n=o)&&n.__esModule?n:{default:n};window.Shinevv=i.default},{"./Shinevv.js":158}],158:[function(e,t,r){"use strict";var i=o(e("babel-runtime/helpers/classCallCheck")),n=o(e("babel-runtime/helpers/createClass")),a=o(e("./ShinevvImpl"));function o(e){return e&&e.__esModule?e:{default:e}}var d=new(o(e("./Logger")).default),s=function(){function o(e,t,r,n){(0,i.default)(this,o),d.debug('constructor() [memberId:"%s", displayName:"%s" serverIp:"%s", serverPort:"%d"]',e,t,r,n),this._shinevvImpl=new a.default({memberId:e,displayName:t,serverIp:r,serverPort:n})}return(0,n.default)(o,[{key:"setVideoLabel",value:function(e,t){d.debug("joinRoom()"),this._shinevvImpl.setVideoLabel({memberId:e,VideoLabelId:t})}},{key:"joinRoom",value:function(e,t,r,n,o,i,a,s,c,u){d.debug("joinRoom()"),this._shinevvImpl.joinRoom({roomId:e,mediaType:{audio:!0,video:t},acessToken:r,onSuccess:n,onFail:o,onDisconnected:i,onClose:a,onNewMemberJoined:s,onMemberLeft:c,onMemberStatusChange:u})}},{key:"leaveRoom",value:function(){d.debug("leaveRoom()"),this._shinevvImpl.leaveRoom()}},{key:"muteMic",value:function(){d.debug("muteMic()"),this._shinevvImpl.muteMic()}},{key:"unmuteMic",value:function(){d.debug("unmuteMic()"),this._shinevvImpl.unmuteMic()}},{key:"disableWebcam",value:function(){d.debug("disableWebcam()"),this._shinevvImpl.disableWebcam()}},{key:"enableWebcam",value:function(){d.debug("enableWebcam()"),this._shinevvImpl.enableWebcam()}},{key:"enableMemberVideo",value:function(e){d.debug("enableMemberVideo()"),this._shinevvImpl.enableMemberVideo(e)}},{key:"disableMemberVideo",value:function(e){d.debug("disableMemberVideo()"),this._shinevvImpl.disableMemberVideo(e)}},{key:"enableMemberAudio",value:function(e){d.debug("enableMemberAudio()"),this._shinevvImpl.enableMemberAudio(e)}},{key:"disableMemberAudio",value:function(e){d.debug("disableMemberAudio()"),this._shinevvImpl.disableMemberAudio(e)}},{key:"startRecord",value:function(){d.debug("startRecord()"),this._shinevvImpl.startRecord()}},{key:"stopRecord",value:function(){d.debug("stopRecord()"),this._shinevvImpl.stopRecord()}}]),o}();t.exports=s},{"./Logger":156,"./ShinevvImpl":159,"babel-runtime/helpers/classCallCheck":7,"babel-runtime/helpers/createClass":8}],159:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var d=v(e("babel-runtime/core-js/get-iterator")),i=v(e("babel-runtime/helpers/extends")),a=v(e("babel-runtime/core-js/array/from")),u=v(e("babel-runtime/core-js/promise")),n=v(e("babel-runtime/core-js/map")),o=v(e("babel-runtime/helpers/classCallCheck")),s=v(e("babel-runtime/helpers/createClass")),c=v(e("protoo-client")),l=e("mediasoup-client"),f=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(l),p=v(e("./Logger")),m=e("./urlFactory"),h=v(e("recordrtc"));function v(e){return e&&e.__esModule?e:{default:e}}var y=new p.default("ShinevvImpl"),g={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},hd:{width:{ideal:1920},height:{ideal:1080}}},_=function(){function t(e){(0,o.default)(this,t),y.debug('constructor() [memberId:"%s", displayName:"%s" serverIp:"%s", serverPort:"%d"]',e.memberId,e.displayName,e.serverIp,e.serverPort),this._closed=!1,this._roomId=null,this._peerName=e.memberId,this._displayName=e.displayName,this._serverIp=e.serverIp,this._serverPort=e.serverPort,this._socket=null,this._room=null,this._device=(0,l.getDeviceInfo)(),this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._webcams=new n.default,this._webcam={device:null,resolution:"hd"},this._videoLabels=new n.default,this._peerTracks=new n.default,this._joinRoomObject=null,this._recordRTC=null,this._recordStreams=[]}return(0,s.default)(t,[{key:"setVideoLabel",value:function(e){if(y.debug("setVideoLabel(OBJECT = %o)",e),e.memberId&&e.VideoLabelId)if(this._videoLabels.has(e.memberId)&&this._videoLabels.delete(e.memberId),this._videoLabels.set(e.memberId,e.VideoLabelId),this._peerTracks.has(e.memberId)){var t=this._peerTracks.get(e.memberId),r=new MediaStream;t.videoTrack&&(y.debug("stream.addTrack(trackInfo.videoTrack)  peerName = %s",peerName),r.addTrack(t.videoTrack)),t.audioTrack&&e.memberId!=this._peerName&&(y.debug("stream.addTrack(trackInfo.audioTrack)  peerName = %s",peerName),r.addTrack(t.audioTrack)),document.getElementById(e.VideoLabelId).srcObject=r}else this._peerTracks.set(e.memberId,{videoTrack:null,audioTrack:null})}},{key:"joinRoom",value:function(e){var t=this;y.debug("connectSocket(OBJECT = %o)",e),this._joinRoomObject=e,this._roomId=e.roomId;var r=(0,m.getProtooUrl)(this._serverIp,this._serverPort,this._peerName,this._roomId,"student",this._displayName,e.acessToken),n=new c.default.WebSocketTransport(r);n||e.onFail&&e.onFail("can not connect the server"),this._room=new f.Room({requestTimeout:1e4,transportOptions:{tcp:!1}}),this._socket=new c.default.Peer(n),this._socket.on("disconnected",function(){y.warn('socket "disconnected" event'),e.onDisconnected&&e.onDisconnected();try{t._room.remoteClose({cause:"socket disconnected"})}catch(e){}}),this._socket.on("close",function(){t._closed||e.onClose&&e.onClose("socket")}),e.onSuccess&&e.onSuccess(),this._join(this._displayName,this._device,e.mediaType,e)}},{key:"leaveRoom",value:function(){var e=this;this._closed||(this._closed=!0,y.debug("leaveRoom()"),this._room.leave(),setTimeout(function(){return e._socket.close()},250))}},{key:"muteMic",value:function(){y.debug("muteMic()"),this._micProducer&&this._micProducer.pause()}},{key:"unmuteMic",value:function(){y.debug("unmuteMic()"),this._micProducer&&this._micProducer.resume()}},{key:"enableWebcam",value:function(){var e=this;return y.debug("enableWebcam()"),u.default.resolve().then(function(){return e._updateWebcams()}).then(function(){return e._setWebcamProducer(e._joinRoomObject)}).catch(function(e){y.error("enableWebcam() | failed: %o",e)})}},{key:"disableWebcam",value:function(){var e=this;return y.debug("disableWebcam()"),u.default.resolve().then(function(){e._webcamProducer.close()}).catch(function(e){y.error("disableWebcam() | failed: %o",e)})}},{key:"changeWebcam",value:function(){var o=this;return y.debug("changeWebcam()"),u.default.resolve().then(function(){return o._updateWebcams()}).then(function(){var e=(0,a.default)(o._webcams.keys()),t=e.length,r=o._webcam.device?o._webcam.device.deviceId:void 0,n=e.indexOf(r);n<t-1?n++:n=0,o._webcam.device=o._webcams.get(e[n]),y.debug("changeWebcam() | new selected webcam [device:%o]",o._webcam.device),o._webcam.resolution="hd"}).then(function(){var e=o._webcam,t=e.device,r=e.resolution;if(!t)throw new Error("no webcam devices");return y.debug("changeWebcam() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia({video:(0,i.default)({deviceId:{exact:t.deviceId}},g[r])})}).then(function(e){var t=e.getVideoTracks()[0];return o._webcamProducer.replaceTrack(t).then(function(e){return t.stop(),e})}).then(function(e){o._setStreamForVideoLabel(o._peerName,"video",e,o._joinRoomObject)}).catch(function(e){y.error("changeWebcam() failed: %o",e),o._dispatch(stateActions.setWebcamInProgress(!1))})}},{key:"enableMemberVideo",value:function(e){y.debug("enableMemberVideo()");var t=this._room.getPeerByName(e);if(t){var r=!0,n=!1,o=void 0;try{for(var i,a=(0,d.default)(t.consumers);!(r=(i=a.next()).done);r=!0){var s=i.value;"video"==s.kind&&s.resume()}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}}else y.debug('memberId="%s" is not define!',e)}},{key:"disableMemberVideo",value:function(e){y.debug("disableMemberVideo()");var t=this._room.getPeerByName(e);if(t){var r=!0,n=!1,o=void 0;try{for(var i,a=(0,d.default)(t.consumers);!(r=(i=a.next()).done);r=!0){var s=i.value;"video"==s.kind&&s.pause("disableMemberVideo")}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}}else y.debug('memberId="%s" is not define!',e)}},{key:"enableMemberAudio",value:function(e){y.debug("enableMemberAudio()");var t=this._room.getPeerByName(e);if(t){var r=!0,n=!1,o=void 0;try{for(var i,a=(0,d.default)(t.consumers);!(r=(i=a.next()).done);r=!0){var s=i.value;"audio"==s.kind&&s.resume()}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}}else y.debug('memberId="%s" is not define!',e)}},{key:"disableMemberAudio",value:function(e){y.debug("disableMemberAudio()");var t=this._room.getPeerByName(e);if(t){var r=!0,n=!1,o=void 0;try{for(var i,a=(0,d.default)(t.consumers);!(r=(i=a.next()).done);r=!0){var s=i.value;"audio"==s.kind&&s.pause("disableMemberAudio")}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}}else y.debug('memberId="%s" is not define!',e)}},{key:"startRecord",value:function(){var i=this;y.debug("startRecord()"),this._peerTracks.forEach(function(e,t,r){var n=e,o=new MediaStream;t==i._peerName&&n.videoTrack&&o.addTrack(n.videoTrack),n.audioTrack&&o.addTrack(n.audioTrack),i._recordStreams.push(o)});this._recordRTC=(0,h.default)(this._recordStreams,{mimeType:"video/webm/audio/wav;codecs=h264",audioBitsPerSecond:128e3,videoBitsPerSecond:128e3,bitsPerSecond:128e3}),this._recordRTC.startRecording()}},{key:"stopRecord",value:function(){var n=this;y.debug("stopRecord()");var o=document.getElementById("downloadLink");o.innerHTML="Download video file";var e="video_"+Math.floor(1e7*Math.random())+".webm";o.setAttribute("download",e),o.setAttribute("name",e),this._recordRTC.stopRecording(function(e){console.log("chenc singleWebM = %o",e),document.getElementById("video_record").src=e;var t=n._recordRTC.getBlob();console.log("chenc recordedBlob=%o",t);var r=window.URL.createObjectURL(t);o.href=r,n._recordRTC.getDataURL(function(e){})})}},{key:"_setMicProducer",value:function(t){var r=this;if(!this._room.canSend("audio"))return u.default.reject(new Error("cannot send audio"));if(this._micProducer)return u.default.reject(new Error("mic Producer already exists"));var n=void 0;return u.default.resolve().then(function(){return y.debug("_setMicProducer() | calling getUserMedia()"),navigator.mediaDevices.getUserMedia({audio:!0})}).then(function(e){var t=e.getAudioTracks()[0];return n=r._room.createProducer(t,null,{source:"mic"}),t.stop(),n.send(r._sendTransport)}).then(function(){r._micProducer=n,r._setStreamForVideoLabel(r._peerName,"audio",n.track,t),n.on("close",function(e){y.debug('mic Producer "close" event [originator:%s]',e),r._micProducer=null,r._setStreamForVideoLabel(r._peerName,"audio",null,t)}),n.on("pause",function(e){y.debug('mic Producer "pause" event [originator:%s]',e),r._setStreamForVideoLabel(r._peerName,"audio",null,t)}),n.on("resume",function(e){y.debug('mic Producer "resume" event [originator:%s]',e),r._setStreamForVideoLabel(r._peerName,"audio",n.track,t)}),n.on("handled",function(){y.debug('mic Producer "handled" event')}),n.on("unhandled",function(){y.debug('mic Producer "unhandled" event')})}).then(function(){y.debug("_setMicProducer() succeeded")}).catch(function(e){throw y.error("_setMicProducer() failed:%o",e),t.onFail&&t.onFail(e.toString()),n&&n.close(),e})}},{key:"_setWebcamProducer",value:function(t){var n=this;if(!this._room.canSend("video"))return u.default.reject(new Error("cannot send video"));if(this._webcamProducer)return u.default.reject(new Error("webcam Producer already exists"));var r=void 0;return u.default.resolve().then(function(){var e=n._webcam,t=e.device,r=e.resolution;if(!t)throw new Error("no webcam devices");return y.debug("_setWebcamProducer() | calling getUserMedia() resolution = %s",r),navigator.mediaDevices.getUserMedia({video:(0,i.default)({deviceId:{exact:t.deviceId}},g[r])})}).then(function(e){var t=e.getVideoTracks()[0];return r=n._room.createProducer(t,{simulcast:n._useSimulcast},{source:"webcam"}),t.stop(),r.send(n._sendTransport)}).then(function(){n._webcamProducer=r;n._webcam.device;n._setStreamForVideoLabel(n._peerName,"video",r.track,t),r.on("close",function(e){y.debug('webcam Producer "close" event [originator:%s]',e),n._webcamProducer=null,n._setStreamForVideoLabel(n._peerName,"video",null,t)}),r.on("pause",function(e){y.debug('webcam Producer "pause" event [originator:%s]',e),n._setStreamForVideoLabel(n._peerName,"video",null,t)}),r.on("resume",function(e){y.debug('webcam Producer "resume" event [originator:%s]',e),n._setStreamForVideoLabel(n._peerName,"video",r.track,t)}),r.on("handled",function(){y.debug('webcam Producer "handled" event')}),r.on("unhandled",function(){y.debug('webcam Producer "unhandled" event')})}).then(function(){y.debug("_setWebcamProducer() succeeded")}).catch(function(e){throw y.error("_setWebcamProducer() failed:%o",e),t.onFail&&t.onFail(e.toString()),r&&r.close(),e})}},{key:"_updateWebcams",value:function(){var s=this;return y.debug("_updateWebcams()"),this._webcams=new n.default,u.default.resolve().then(function(){return y.debug("_updateWebcams() | calling enumerateDevices()"),navigator.mediaDevices.enumerateDevices()}).then(function(e){var t=!0,r=!1,n=void 0;try{for(var o,i=(0,d.default)(e);!(t=(o=i.next()).done);t=!0){var a=o.value;"videoinput"===a.kind&&s._webcams.set(a.deviceId,a)}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}).then(function(){var e=(0,a.default)(s._webcams.values()),t=e.length,r=s._webcam.device?s._webcam.device.deviceId:void 0;y.debug("_updateWebcams() [webcams:%o]",e),0===t?s._webcam.device=null:s._webcams.has(r)||(s._webcam.device=e[0])})}},{key:"_join",value:function(e,t,r,n){var o=this;this._socket.on("open",function(){y.debug('_socket "open" event'),o._joinRoom(e,t,r,n)}),this._socket.on("request",function(e,t,r){switch(y.debug("_handleRequest() [method:%s, data:%o]",e.method,e.data),e.method){case"mediasoup-notification":t();var n=e.data;o._room.receiveNotification(n);break;case"active-speaker":t();e.data.peerName;break;default:y.error('unknown protoo method "%s"',e.method),r(404,"unknown method")}})}},{key:"_joinRoom",value:function(e,t,r,s){var c=this;y.debug("_joinRoom()"),this._room.removeAllListeners(),this._room.on("close",function(e,t){"remote"!==e||s.onClose&&s.onClose("Room close by remote")}),this._room.on("request",function(e,t,r){y.debug("sending request [method:%s]:%o",e.method,e),c._socket.send("mediasoup-request",e).then(t).catch(r)}),this._room.on("notify",function(e){y.debug("sending notification [method:%s]:%o",e.method,e),c._socket.send("mediasoup-notification",e).catch(function(e){y.warn("could not send notification:%o",e)})}),this._room.on("newpeer",function(e){y.debug('room "newpeer" event [name:"%s", peer:%o]',e.name,e),c._handlePeer(s,e)}),this._room.join(this._peerName,{displayName:e,device:t}).then(function(){c._sendTransport=c._room.createTransport("send",{media:"SEND_MIC_WEBCAM"}),c._sendTransport.on("close",function(e){y.debug('Transport "close" event [originator:%s]',e)}),c._recvTransport=c._room.createTransport("recv",{media:"RECV"}),c._recvTransport.on("close",function(e){y.debug('receiving Transport "close" event [originator:%s]',e)})}).then(function(){u.default.resolve().then(function(){c._room.canSend("audio")&&r.audio&&c._setMicProducer(s).catch(function(){})}).then(function(){c._room.canSend("video")&&r.video&&c.enableWebcam(c._joinRoomObject)})}).then(function(){var e=c._room.peers,t=!0,r=!1,n=void 0;try{for(var o,i=(0,d.default)(e);!(t=(o=i.next()).done);t=!0){var a=o.value;c._handlePeer(s,a,{notify:!1})}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}}).catch(function(e){y.error("_joinRoom() failed:%o",e),s.onFail&&s.onFail(e.toString())})}},{key:"_handlePeer",value:function(t,r){var n=this,e=((2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).notify,r.appData.displayName);t.onNewMemberJoined&&t.onNewMemberJoined(r.name,e);var o=!0,i=!1,a=void 0;try{for(var s,c=(0,d.default)(r.consumers);!(o=(s=c.next()).done);o=!0){var u=s.value;this._handleConsumer(t,u)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}r.on("close",function(e){y.debug('peer "close" event [name:"%s", originator:%s]',r.name,e),t.onMemberLeft&&(n._videoLabels.has(r.name)&&n._videoLabels.delete(r.name),n._peerTracks.has(r.name)&&n._peerTracks.delete(r.name),t.onMemberLeft(r.name,r.appData.displayName))}),r.on("newconsumer",function(e){y.debug('peer "newconsumer" event [name:"%s", id:%s, consumer:%o]',r.name,e.id,e),n._handleConsumer(t,e)})}},{key:"_handleConsumer",value:function(a,s){var c=this;s.on("close",function(e){y.debug('consumer "close" event [id:%s, originator:%s, consumer:%o]',s.id,e,s);var t=void 0;"mic"===s.appData.source?t="audio":"webcam"===s.appData.source&&(t="video"),c._setStreamForVideoLabel(s.peer.name,t,null,a)}),s.on("pause",function(e){y.debug('consumer "pause" event [id:%s, originator:%s, consumer:%o]',s.id,e,s);var t=void 0;"mic"===s.appData.source?t="audio":"webcam"===s.appData.source&&(t="video"),c._setStreamForVideoLabel(s.peer.name,t,null,a)}),s.on("resume",function(e){y.debug('consumer "resume" event [id:%s, originator:%s, consumer:%o]',s.id,e,s);var t=void 0;"mic"===s.appData.source?t="audio":"webcam"===s.appData.source&&(t="video"),c._setStreamForVideoLabel(s.peer.name,t,s.track,a)}),s.supported&&s.receive(this._recvTransport).then(function(e){var t=void 0;"mic"===s.appData.source?t="audio":"webcam"===s.appData.source&&(t="video");var r=s.peer.name;if(c._peerTracks.has(s.peer.name)){var n=c._peerTracks.get(s.peer.name);n.videoTrack&&n.audioTrack&&(r=s.peer.name+"_vice",console.log("chenc peername_ = %s",r))}if(console.log("chenc this._recordRTC = %o",c._recordRTC),c._recordRTC&&"recording"===c._recordRTC.state){var o=c._recordRTC.getInternalRecorder();console.log("chenc msRecorder = %o",o);var i=new MediaStream;i.addTrack(e),o.addStreams(i)}c._setStreamForVideoLabel(r,t,e,a)}).catch(function(e){y.error("unexpected error while receiving a new Consumer:%o",e)})}},{key:"_setStreamForVideoLabel",value:function(e,t,r,n){y.debug("_setStreamForVideoLabel [peerName:%s, kind:%s, track:%o OBJECT:%o]",e,t,r,n);var o=null;if(this._peerTracks.has(e)){var i=this._peerTracks.get(e);"audio"==t?(y.debug("trackInfo.audioTrack = track  peerName = %s",e),i.audioTrack=r):(y.debug("trackInfo.videoTrack = track  peerName = %s",e),i.videoTrack=r),o=new MediaStream,i.videoTrack&&(y.debug("stream.addTrack(trackInfo.videoTrack)  peerName = %s",e),o.addTrack(i.videoTrack)),i.audioTrack&&e!=this._peerName&&(y.debug("stream.addTrack(trackInfo.audioTrack)  peerName = %s",e),o.addTrack(i.audioTrack)),this._peerTracks[this._peerName]=i}if(this._videoLabels.has(e)&&o){var a=this._videoLabels.get(e);document.getElementById(a).srcObject=o,n.onMemberStatusChange&&n.onMemberStatusChange(e,t,null!=r)}}}]),t}();r.default=_},{"./Logger":156,"./urlFactory":160,"babel-runtime/core-js/array/from":1,"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/map":3,"babel-runtime/core-js/promise":6,"babel-runtime/helpers/classCallCheck":7,"babel-runtime/helpers/createClass":8,"babel-runtime/helpers/extends":9,"mediasoup-client":132,"protoo-client":139,recordrtc:145}],160:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getProtooUrl=function(e,t,r,n,o,i,a){return"wss://"+e+":"+t+"/?peerName="+r+"&roomId="+n+"&role="+o+"&accessToken="+a+"&displayName="+i}},{}]},{},[157]);